#!python
# This file is placed in the Public Domain.

__version__ = 127

import os, sys ; sys.path.insert(0, os.getcwd())

import atexit
import os
import readline
import sys
import termios
import bot.all

wd = os.path.expanduser("~/.bot")

from bot.krn import Kernel, Client, kernel
from trm import cprint, wrap

class Runtime(Kernel):

    def error(self, txt):
        cprint(txt)

    def log(self, txt):
        if self.opts("v"):
            cprint(txt)


class CLI(Client):

    def raw(self, txt):
        cprint(txt)

class Console(CLI):
    def handle(self, e):
        k.put(e)
        e.wait()

    def poll(self):
        return input("> ")

k = Runtime()

def ver(event):
    event.reply("BOT %s" % __version__)

def main():
    k.boot()
    k.scan("bot")
    k.add(ver)
    if k.cfg.txt:
        c = CLI()
        return c.cmd(k.cfg.otxt)
    if k.opts("c") or k.cfg.m:
        k.start()
        csl = Console()
        csl.start()
        k.init(k.cfg.m)
        k.wait()

wrap(main)
