(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[5424],{11950:function(t,n,e){"use strict";function r(t,n,e,r,i,u,a){try{var o=t[u](a),s=o.value}catch(c){return void e(c)}o.done?n(s):Promise.resolve(s).then(r,i)}e.d(n,{l:function(){return i}});var i=function(){var t,n=(t=regeneratorRuntime.mark((function t(n,e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var r=e(n,(function(n){r(),t(n)}))})));case 1:case"end":return t.stop()}}),t)})),function(){var n=this,e=arguments;return new Promise((function(i,u){var a=t.apply(n,e);function o(t){r(a,i,u,o,s,"next",t)}function s(t){r(a,i,u,o,s,"throw",t)}o(void 0)}))});return function(t,e){return n.apply(this,arguments)}}()},81582:function(t,n,e){"use strict";e.d(n,{LZ:function(){return r},pB:function(){return i},SO:function(){return u},iJ:function(){return a},Nn:function(){return o},Ny:function(){return s},T0:function(){return c}});var r=2143==e.j?["migration_error","setup_error","setup_retry"]:null,i=function(t){return t.callApi("GET","config/config_entries/entry")},u=function(t,n,e){return t.callWS(Object.assign({type:"config_entries/update",entry_id:n},e))},a=function(t,n){return t.callApi("DELETE","config/config_entries/entry/".concat(n))},o=function(t,n){return t.callApi("POST","config/config_entries/entry/".concat(n,"/reload"))},s=function(t,n){return t.callWS({type:"config_entries/disable",entry_id:n,disabled_by:"user"})},c=function(t,n){return t.callWS({type:"config_entries/disable",entry_id:n,disabled_by:null})}},55424:function(t,n,e){"use strict";e.d(n,{Bm:function(){return w},o1:function(){return S},iK:function(){return k},rl:function(){return T},P:function(){return O},KU:function(){return x},ZC:function(){return D},_Z:function(){return Z},Jj:function(){return A},UB:function(){return P}});var r=e(59699),i=e(27088),u=e(83008),a=e(70390),o=e(61334),s=e(95282),c=e(11950),f=e(81582),l=e(74186),y=e(58763);function _(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var r,i,u=[],a=!0,o=!1;try{for(e=e.call(t);!(a=(r=e.next()).done)&&(u.push(r.value),!n||u.length!==n);a=!0);}catch(s){o=!0,i=s}finally{try{a||null==e.return||e.return()}finally{if(o)throw i}}return u}(t,n)||p(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=p(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,a=!0,o=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){o=!0,u=t},f:function(){try{a||null==e.return||e.return()}finally{if(o)throw u}}}}function p(t,n){if(t){if("string"==typeof t)return g(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?g(t,n):void 0}}function g(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function m(t,n,e,r,i,u,a){try{var o=t[u](a),s=o.value}catch(c){return void e(c)}o.done?n(s):Promise.resolve(s).then(r,i)}function v(t){return function(){var n=this,e=arguments;return new Promise((function(r,i){var u=t.apply(n,e);function a(t){m(u,r,i,a,o,"next",t)}function o(t){m(u,r,i,a,o,"throw",t)}a(void 0)}))}}var h,b=[],w=function(){return{stat_energy_from:"",stat_cost:null,entity_energy_from:null,entity_energy_price:null,number_energy_price:null}},S=function(){return{stat_energy_to:"",stat_compensation:null,entity_energy_to:null,entity_energy_price:null,number_energy_price:null}},k=function(){return{type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}},T=function(){return{type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}},O=function(){return{type:"battery",stat_energy_from:"",stat_energy_to:""}},x=function(){return{type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_from:null,entity_energy_price:null,number_energy_price:null}},j=function(t){return t.callWS({type:"energy/info"})},D=function(t){return t.callWS({type:"energy/get_prefs"})},Z=2143==e.j?(h=v(regeneratorRuntime.mark((function t(n,e){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.callWS(Object.assign({type:"energy/save_prefs"},e)),E(n),t.abrupt("return",r);case 3:case"end":return t.stop()}}),t)}))),function(t,n){return h.apply(this,arguments)}):null,A=function(t){var n,e={},r=d(t.energy_sources);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.type in e?e[i.type].push(i):e[i.type]=[i]}}catch(u){r.e(u)}finally{r.f()}return e},I=function(){var t=v(regeneratorRuntime.mark((function t(n,e,i,u){var a,o,s,p,g,m,v,h,b,w,S,k,T,O,x,D,Z,A,I,E,P,W,M,R,C,N;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([(0,f.pB)(n),(0,c.l)(n.connection,l.LM),j(n)]);case 2:if(a=t.sent,o=_(a,3),s=o[0],p=o[1],g=o[2],!(m=s.find((function(t){return"co2signal"===t.domain})))){t.next=31;break}h=d(p),t.prev=10,h.s();case 12:if((b=h.n()).done){t.next=23;break}if((w=b.value).config_entry_id===m.entry_id){t.next=16;break}return t.abrupt("continue",21);case 16:if((S=n.states[w.entity_id])&&"%"===S.attributes.unit_of_measurement){t.next=19;break}return t.abrupt("continue",21);case 19:return v=S.entity_id,t.abrupt("break",23);case 21:t.next=12;break;case 23:t.next=28;break;case 25:t.prev=25,t.t0=t.catch(10),h.e(t.t0);case 28:return t.prev=28,h.f(),t.finish(28);case 31:k=[],void 0!==v&&k.push(v),T=d(e.energy_sources),t.prev=34,T.s();case 36:if((O=T.n()).done){t.next=57;break}if("solar"!==(x=O.value).type){t.next=41;break}return k.push(x.stat_energy_from),t.abrupt("continue",55);case 41:if("gas"!==x.type){t.next=47;break}return k.push(x.stat_energy_from),x.stat_cost&&k.push(x.stat_cost),(D=g.cost_sensors[x.stat_energy_from])&&k.push(D),t.abrupt("continue",55);case 47:if("battery"!==x.type){t.next=51;break}return k.push(x.stat_energy_from),k.push(x.stat_energy_to),t.abrupt("continue",55);case 51:Z=d(x.flow_from);try{for(Z.s();!(A=Z.n()).done;)I=A.value,k.push(I.stat_energy_from),I.stat_cost&&k.push(I.stat_cost),(E=g.cost_sensors[I.stat_energy_from])&&k.push(E)}catch(L){Z.e(L)}finally{Z.f()}P=d(x.flow_to);try{for(P.s();!(W=P.n()).done;)M=W.value,k.push(M.stat_energy_to),M.stat_compensation&&k.push(M.stat_compensation),(R=g.cost_sensors[M.stat_energy_to])&&k.push(R)}catch(L){P.e(L)}finally{P.f()}case 55:t.next=36;break;case 57:t.next=62;break;case 59:t.prev=59,t.t1=t.catch(34),T.e(t.t1);case 62:return t.prev=62,T.f(),t.finish(62);case 65:return t.next=67,(0,y.dL)(n,(0,r.Z)(i,-1),u,k);case 67:return C=t.sent,N={start:i,end:u,info:g,prefs:e,stats:C,co2SignalConfigEntry:m,co2SignalEntity:v},t.abrupt("return",N);case 70:case"end":return t.stop()}}),t,null,[[10,25,28,31],[34,59,62,65]])})));return function(n,e,r,i){return t.apply(this,arguments)}}(),E=function(t){b.forEach((function(n){var e=P(t,{key:n});e.clearPrefs(),e._active&&e.refresh()}))},P=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e="_energy";if(n.key){if(!n.key.startsWith("energy_"))throw new Error("Key need to start with energy_");e="_".concat(n.key)}if(t.connection[e])return t.connection[e];b.push(n.key);var c=(0,s._)(t.connection,e,v(regeneratorRuntime.mark((function n(){var e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c.prefs){n.next=4;break}return n.next=3,D(t);case 3:c.prefs=n.sent;case 4:return c._refreshTimeout&&clearTimeout(c._refreshTimeout),c._active&&(!c.end||c.end>new Date)&&((e=new Date).getMinutes()>=20&&e.setHours(e.getHours()+1),e.setMinutes(20,0,0),c._refreshTimeout=window.setTimeout((function(){return c.refresh()}),e.getTime()-Date.now())),n.abrupt("return",I(t,c.prefs,c.start,c.end));case 7:case"end":return n.stop()}}),n)})))),f=c.subscribe;c.subscribe=function(t){var n=f(t);return c._active++,function(){c._active--,c._active<1&&(clearTimeout(c._refreshTimeout),c._refreshTimeout=void 0),n()}},c._active=0,c.prefs=n.prefs;var l=new Date;c.start=l.getHours()>0?(0,i.Z)():(0,u.Z)(),c.end=l.getHours()>0?(0,a.Z)():(0,o.Z)();var y=function t(){c._updatePeriodTimeout=window.setTimeout((function(){c.start=(0,i.Z)(),c.end=(0,a.Z)(),t()}),(0,r.Z)((0,a.Z)(),1).getTime()-Date.now())};return y(),c.clearPrefs=function(){c.prefs=void 0},c.setPeriod=function(t,n){var e;c.start=t,c.end=n,c.start.getTime()!==(0,i.Z)().getTime()||(null===(e=c.end)||void 0===e?void 0:e.getTime())!==(0,a.Z)().getTime()||c._updatePeriodTimeout?c._updatePeriodTimeout&&(clearTimeout(c._updatePeriodTimeout),c._updatePeriodTimeout=void 0):y()},c}},74186:function(t,n,e){"use strict";e.d(n,{eD:function(){return a},Mw:function(){return o},vA:function(){return s},L3:function(){return c},Nv:function(){return f},z3:function(){return l},LM:function(){return d}});var r=e(95282);if(2143==e.j)var i=e(91741);var u=e(38346),a=function(t,n){return n.find((function(n){return t.states[n.entity_id]&&"battery"===t.states[n.entity_id].attributes.device_class}))},o=function(t,n){return n.find((function(n){return t.states[n.entity_id]&&"battery_charging"===t.states[n.entity_id].attributes.device_class}))},s=function(t,n){if(n.name)return n.name;var e=t.states[n.entity_id];return e?(0,i.C)(e):null},c=function(t,n){return t.callWS({type:"config/entity_registry/get",entity_id:n})},f=function(t,n,e){return t.callWS(Object.assign({type:"config/entity_registry/update",entity_id:n},e))},l=function(t,n){return t.callWS({type:"config/entity_registry/remove",entity_id:n})},y=function(t){return t.sendMessagePromise({type:"config/entity_registry/list"})},_=function(t,n){return t.subscribeEvents((0,u.D)((function(){return y(t).then((function(t){return n.setState(t,!0)}))}),500,!0),"entity_registry_updated")},d=function(t,n){return(0,r.B)("_entityRegistry",y,_,t,n)}},58763:function(t,n,e){"use strict";e.d(n,{vq:function(){return d},_J:function(){return p},Nu:function(){return m},uR:function(){return v},dL:function(){return h},Kj:function(){return b},q6:function(){return w},Nw:function(){return S},m2:function(){return k},VU:function(){return T},Kk:function(){return O}});var r=e(13250),i=e(79021),u=e(59429),a=e(32182),o=e(29171),s=e(22311),c=e(91741);function f(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"==typeof t)return l(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return l(t,n)}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,a=!0,o=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){o=!0,u=t},f:function(){try{a||null==e.return||e.return()}finally{if(o)throw u}}}}function l(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}var y=["climate","humidifier","water_heater"],_=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode"],d=function(t,n,e,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5?arguments[5]:void 0,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o="history/period";return e&&(o+="/"+e.toISOString()),o+="?filter_entity_id="+n,r&&(o+="&end_time="+r.toISOString()),i&&(o+="&skip_initial_state"),void 0!==u&&(o+="&significant_changes_only=".concat(Number(u))),a&&(o+="&minimal_response"),t.callApi("GET",o)},p=function(t,n,e,r){return t.callApi("GET","history/period/".concat(n.toISOString(),"?end_time=").concat(e.toISOString(),"&minimal_response").concat(r?"&filter_entity_id=".concat(r):""))},g=function(t,n){return t.state===n.state&&(!t.attributes||!n.attributes||_.every((function(e){return t.attributes[e]===n.attributes[e]})))},m=function(t,n,e){var r={},i=[];return n?(n.forEach((function(n){if(0!==n.length){var u,a=n.find((function(t){return t.attributes&&"unit_of_measurement"in t.attributes}));(u=a?a.attributes.unit_of_measurement:{climate:t.config.unit_system.temperature,counter:"#",humidifier:"%",input_number:"#",number:"#",water_heater:t.config.unit_system.temperature}[(0,s.N)(n[0])])?u in r?r[u].push(n):r[u]=[n]:i.push(function(t,n,e){var r,i=[],u=e.length-1,a=f(e);try{for(a.s();!(r=a.n()).done;){var s=r.value;i.length>0&&s.state===i[i.length-1].state||(s.entity_id||(s.attributes=e[u].attributes,s.entity_id=e[u].entity_id),i.push({state_localize:(0,o.D)(t,s,n),state:s.state,last_changed:s.last_changed}))}}catch(l){a.e(l)}finally{a.f()}return{name:(0,c.C)(e[0]),entity_id:e[0].entity_id,data:i}}(e,t.locale,n))}})),{line:Object.keys(r).map((function(t){return function(t,n){var e,r=[],i=f(n);try{for(i.s();!(e=i.n()).done;){var u,a=e.value,o=a[a.length-1],l=(0,s.N)(o),d=[],p=f(a);try{for(p.s();!(u=p.n()).done;){var m=u.value,v=void 0;if(y.includes(l)){v={state:m.state,last_changed:m.last_updated,attributes:{}};var h,b=f(_);try{for(b.s();!(h=b.n()).done;){var w=h.value;w in m.attributes&&(v.attributes[w]=m.attributes[w])}}catch(S){b.e(S)}finally{b.f()}}else v=m;d.length>1&&g(v,d[d.length-1])&&g(v,d[d.length-2])||d.push(v)}}catch(S){p.e(S)}finally{p.f()}r.push({domain:l,name:(0,c.C)(o),entity_id:o.entity_id,states:d})}}catch(S){i.e(S)}finally{i.f()}return{unit:t,identifier:n.map((function(t){return t[0].entity_id})).join(""),data:r}}(t,r[t])})),timeline:i}):{line:[],timeline:[]}},v=function(t,n){return t.callWS({type:"history/list_statistic_ids",statistic_type:n})},h=function(t,n,e,r){return t.callWS({type:"history/statistics_during_period",start_time:n.toISOString(),end_time:null==e?void 0:e.toISOString(),statistic_ids:r})},b=function(t){if(!t||t.length<2)return null;var n=t[t.length-1].sum;if(null===n)return null;var e=t[0].sum;return null===e?n:n-e},w=function(t,n){var e,r=null,i=f(n);try{for(i.s();!(e=i.n()).done;){var u=e.value;if(u in t){var a=b(t[u]);null!==a&&(null===r?r=a:r+=a)}}}catch(o){i.e(o)}finally{i.f()}return r},S=function(t,n){return t.some((function(t){return null!==t[n]}))},k=function(t,n){var e=null;if(0===n.length||0===t.length)return null;var r,i=(r={},n.forEach((function(t){if(0!==t.length){var n=null;t.forEach((function(t){if(null!==t.sum)if(null!==n){var e=t.sum-n;t.start in r?r[t.start]+=e:r[t.start]=e,n=t.sum}else n=t.sum}))}})),r);return t.forEach((function(t){var n=i[t.start];void 0!==n&&(null===e?e=n*(t.mean/100):e+=n*(t.mean/100))})),e},T=function(t){if(null==t||!t.length)return[];var n,e,a=[];t.length>1&&new Date(t[0].start).getDate()===new Date(t[1].start).getDate()&&a.push(Object.assign({},t[0],{start:(0,r.Z)((0,i.Z)(new Date(t[0].start),-1)).toISOString()}));var o,s=f(t);try{for(s.s();!(o=s.n()).done;){var c=o.value,l=new Date(c.start).getDate();void 0===e&&(e=l),e!==l&&(a.push(Object.assign({},n,{start:(0,u.Z)(new Date(n.start)).toISOString()})),e=l),n=c}}catch(y){s.e(y)}finally{s.f()}return a.push(Object.assign({},n,{start:(0,u.Z)(new Date(n.start)).toISOString()})),a},O=function(t){if(null==t||!t.length)return[];var n,e,i=[];t.length>1&&new Date(t[0].start).getMonth()===new Date(t[1].start).getMonth()&&i.push(Object.assign({},t[0],{start:(0,r.Z)((0,a.Z)(new Date(t[0].start),-1)).toISOString()}));var u,o=f(t);try{for(o.s();!(u=o.n()).done;){var s=u.value,c=new Date(s.start).getMonth();void 0===e&&(e=c),e!==c&&(i.push(Object.assign({},n,{start:(0,r.Z)(new Date(n.start)).toISOString()})),e=c),n=s}}catch(l){o.e(l)}finally{o.f()}return i.push(Object.assign({},n,{start:(0,r.Z)(new Date(n.start)).toISOString()})),i}}}]);
//# sourceMappingURL=6bbe73c5.js.map