{"version":3,"file":"chunks/app_views_settings_account_accountNotifications_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/settings/account/notifications/notificationSettings.tsx","webpack:///./app/views/settings/account/accountNotifications.tsx"],"sourcesContent":["import React from 'react';\n\nimport AlertLink from 'app/components/alertLink';\nimport AsyncComponent from 'app/components/asyncComponent';\nimport Link from 'app/components/links/link';\nimport {IconMail} from 'app/icons';\nimport {t} from 'app/locale';\nimport {\n  NOTIFICATION_SETTINGS_TYPES,\n  NotificationSettingsObject,\n  SELF_NOTIFICATION_SETTINGS_TYPES,\n} from 'app/views/settings/account/notifications/constants';\nimport FeedbackAlert from 'app/views/settings/account/notifications/feedbackAlert';\nimport {NOTIFICATION_SETTING_FIELDS} from 'app/views/settings/account/notifications/fields2';\nimport {\n  decideDefault,\n  getParentIds,\n  getStateToPutForDefault,\n  mergeNotificationSettings,\n} from 'app/views/settings/account/notifications/utils';\nimport Form from 'app/views/settings/components/forms/form';\nimport JsonForm from 'app/views/settings/components/forms/jsonForm';\nimport {FieldObject} from 'app/views/settings/components/forms/type';\nimport SettingsPageHeader from 'app/views/settings/components/settingsPageHeader';\nimport TextBlock from 'app/views/settings/components/text/textBlock';\n\ntype Props = AsyncComponent['props'];\n\ntype State = {\n  notificationSettings: NotificationSettingsObject;\n  legacyData: {[key: string]: string};\n} & AsyncComponent['state'];\n\nclass NotificationSettings extends AsyncComponent<Props, State> {\n  getDefaultState(): State {\n    return {\n      ...super.getDefaultState(),\n      notificationSettings: {},\n      legacyData: {},\n    };\n  }\n\n  getEndpoints(): ReturnType<AsyncComponent['getEndpoints']> {\n    return [\n      ['notificationSettings', `/users/me/notification-settings/`],\n      ['legacyData', '/users/me/notifications/'],\n    ];\n  }\n\n  getStateToPutForDefault = (\n    changedData: {[key: string]: string},\n    notificationType: string\n  ) => {\n    /**\n     * Update the current providers' parent-independent notification settings\n     * with the new value. If the new value is \"never\", then also update all\n     * parent-specific notification settings to \"default\". If the previous value\n     * was \"never\", then assume providerList should be \"email\" only.\n     */\n\n    const {notificationSettings} = this.state;\n\n    const updatedNotificationSettings = getStateToPutForDefault(\n      notificationType,\n      notificationSettings,\n      changedData,\n      getParentIds(notificationType, notificationSettings)\n    );\n\n    this.setState({\n      notificationSettings: mergeNotificationSettings(\n        notificationSettings,\n        updatedNotificationSettings\n      ),\n    });\n\n    return updatedNotificationSettings;\n  };\n\n  getInitialData(): {[key: string]: string} {\n    const {notificationSettings} = this.state;\n\n    return Object.fromEntries(\n      NOTIFICATION_SETTINGS_TYPES.map(notificationType => [\n        notificationType,\n        decideDefault(notificationType, notificationSettings),\n      ])\n    );\n  }\n\n  getFields(): FieldObject[] {\n    return NOTIFICATION_SETTINGS_TYPES.map(\n      notificationType =>\n        Object.assign({}, NOTIFICATION_SETTING_FIELDS[notificationType], {\n          getData: data => this.getStateToPutForDefault(data, notificationType),\n          help: (\n            <React.Fragment>\n              {NOTIFICATION_SETTING_FIELDS[notificationType].help}\n              &nbsp;\n              <Link to={`/settings/account/notifications/${notificationType}`}>\n                Fine tune\n              </Link>\n            </React.Fragment>\n          ),\n        }) as FieldObject\n    );\n  }\n\n  renderBody() {\n    const {legacyData} = this.state;\n\n    return (\n      <React.Fragment>\n        <SettingsPageHeader title=\"Notifications\" />\n        <TextBlock>Personal notifications sent via email or an integration.</TextBlock>\n        <FeedbackAlert />\n        <Form\n          saveOnBlur\n          apiMethod=\"PUT\"\n          apiEndpoint=\"/users/me/notification-settings/\"\n          initialData={this.getInitialData()}\n        >\n          <JsonForm title={t('Notifications')} fields={this.getFields()} />\n        </Form>\n        <Form\n          initialData={legacyData}\n          saveOnBlur\n          apiMethod=\"PUT\"\n          apiEndpoint=\"/users/me/notifications/\"\n        >\n          <JsonForm\n            title={t('My Activity')}\n            fields={SELF_NOTIFICATION_SETTINGS_TYPES.map(\n              type => NOTIFICATION_SETTING_FIELDS[type] as FieldObject\n            )}\n          />\n        </Form>\n        <AlertLink to=\"/settings/account/emails\" icon={<IconMail />}>\n          {t('Looking to add or remove an email address? Use the emails panel.')}\n        </AlertLink>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default NotificationSettings;\n","import styled from '@emotion/styled';\n\nimport AlertLink from 'app/components/alertLink';\nimport Link from 'app/components/links/link';\nimport {PanelFooter} from 'app/components/panels';\nimport accountNotificationFields from 'app/data/forms/accountNotificationSettings';\nimport {IconChevron, IconMail} from 'app/icons';\nimport {t} from 'app/locale';\nimport {OrganizationSummary} from 'app/types';\nimport withOrganizations from 'app/utils/withOrganizations';\nimport AsyncView from 'app/views/asyncView';\nimport NotificationSettings from 'app/views/settings/account/notifications/notificationSettings';\nimport Form from 'app/views/settings/components/forms/form';\nimport JsonForm from 'app/views/settings/components/forms/jsonForm';\nimport SettingsPageHeader from 'app/views/settings/components/settingsPageHeader';\n\nconst FINE_TUNE_FOOTERS = {\n  [t('Alerts')]: {\n    text: t('Fine tune alerts by project'),\n    path: 'alerts/',\n  },\n  [t('Workflow Notifications')]: {\n    text: t('Fine tune workflow notifications by project'),\n    path: 'workflow/',\n  },\n  [t('Email Routing')]: {\n    text: t('Fine tune email routing by project'),\n    path: 'email/',\n  },\n  [t('Weekly Reports')]: {\n    text: t('Fine tune weekly reports by organization'),\n    path: 'reports/',\n  },\n  [t('Deploy Notifications')]: {\n    text: t('Fine tune deploy notifications by organization'),\n    path: 'deploy/',\n  },\n};\n\ntype Props = AsyncView['props'] & {\n  organizations: OrganizationSummary[];\n};\n\ntype State = AsyncView['state'] & {\n  data: Record<string, unknown> | null;\n};\n\nclass AccountNotifications extends AsyncView<Props, State> {\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    return [['data', '/users/me/notifications/']];\n  }\n\n  getTitle() {\n    return 'Notifications';\n  }\n\n  renderBody() {\n    const {organizations} = this.props;\n    if (\n      organizations.some(organization =>\n        organization.features.includes('notification-platform')\n      )\n    ) {\n      return <NotificationSettings />;\n    }\n\n    return (\n      <div>\n        <SettingsPageHeader title=\"Notifications\" />\n        <Form\n          initialData={this.state.data ?? undefined}\n          saveOnBlur\n          apiMethod=\"PUT\"\n          apiEndpoint=\"/users/me/notifications/\"\n        >\n          <JsonForm\n            forms={accountNotificationFields}\n            renderFooter={({title}) => {\n              if (typeof title !== 'string') {\n                return null;\n              }\n              if (FINE_TUNE_FOOTERS[title]) {\n                return <FineTuningFooter {...FINE_TUNE_FOOTERS[title]} />;\n              }\n              return null;\n            }}\n          />\n          <AlertLink to=\"/settings/account/emails\" icon={<IconMail />}>\n            {t('Looking to add or remove an email address? Use the emails panel.')}\n          </AlertLink>\n        </Form>\n      </div>\n    );\n  }\n}\n\nconst FineTuneLink = styled(Link)`\n  display: flex;\n  justify-content: space-between;\n  padding: 15px 20px;\n  color: inherit;\n`;\n\ntype FooterProps = {\n  path: string;\n  text: string;\n};\n\nconst FineTuningFooter = ({path, text}: FooterProps) => (\n  <PanelFooter css={{borderTop: 'none'}}>\n    <FineTuneLink to={`/settings/account/notifications/${path}`}>\n      <span>{text}</span>\n      <IconChevron direction=\"right\" size=\"15px\" />\n    </FineTuneLink>\n  </PanelFooter>\n);\n\nexport default withOrganizations(AccountNotifications);\n"],"names":["NotificationSettings","AsyncComponent","changedData","notificationType","notificationSettings","this","state","updatedNotificationSettings","getStateToPutForDefault","getParentIds","setState","mergeNotificationSettings","getDefaultState","super","legacyData","getEndpoints","getInitialData","Object","fromEntries","NOTIFICATION_SETTINGS_TYPES","decideDefault","getFields","assign","NOTIFICATION_SETTING_FIELDS","getData","data","help","to","renderBody","title","saveOnBlur","apiMethod","apiEndpoint","initialData","t","fields","SELF_NOTIFICATION_SETTINGS_TYPES","type","icon","FINE_TUNE_FOOTERS","text","path","AccountNotifications","AsyncView","getTitle","organizations","props","some","organization","features","includes","undefined","forms","accountNotificationFields","renderFooter","FineTuningFooter","FineTuneLink","Link","css","direction","size","withOrganizations"],"sourceRoot":""}