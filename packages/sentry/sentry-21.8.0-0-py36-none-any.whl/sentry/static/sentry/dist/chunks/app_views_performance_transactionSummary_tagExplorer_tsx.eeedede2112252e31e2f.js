"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_performance_transactionSummary_tagExplorer_tsx"],{"./app/utils/performance/segmentExplorer/segmentExplorerQuery.tsx":(e,t,a)=>{a.d(t,{Z:()=>c}),a("../node_modules/react/index.js");var r=a("./app/utils/discover/genericDiscoverQuery.tsx"),n=a("./app/utils/withApi.tsx"),o=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function s(e){const{aggregateColumn:t}=e;return function(a){const{eventView:r}=a,n=r.getEventsAPIPayload(a.location);return n.aggregateColumn=t,n.sort=e.sort?e.sort:n.sort,e.allTagKeys&&(n.allTagKeys=e.allTagKeys),e.tagKey&&(n.tagKey=e.tagKey),n}}function i(e,t){return e.aggregateColumn!==t.aggregateColumn||e.sort!==t.sort||e.allTagKeys!==t.allTagKeys||e.tagKey!==t.tagKey}function l(e){return(0,o.tZ)(r.Z,{route:"events-facets-performance",getRequestPayload:s(e),shouldRefetchData:i,...e})}l.displayName="SegmentExplorerQuery";const c=(0,n.Z)(l)},"./app/views/performance/transactionSummary/tagExplorer.tsx":(e,t,a)=>{a.d(t,{e2:()=>K,xS:()=>N,D_:()=>I});var r=a("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/core-js/modules/es.string.trim.js"),a("../node_modules/react/index.js")),s=a("../node_modules/react-router/es/index.js"),i=a("./app/components/acl/feature.tsx"),l=a("./app/components/assistant/guideAnchor.tsx"),c=a("./app/components/button.tsx"),d=a("./app/components/charts/styles.tsx"),u=a("./app/components/featureBadge.tsx"),p=a("./app/components/gridEditable/index.tsx"),g=a("./app/components/gridEditable/sortLink.tsx"),m=a("./app/components/links/link.tsx"),y=a("./app/components/pagination/index.tsx"),h=a("./app/locale.tsx"),f=a("./app/styles/space.tsx"),v=a("./app/utils/analytics.tsx"),x=a("./app/utils/discover/eventView.tsx"),k=a("./app/utils/discover/fields.tsx"),w=a("./app/utils/formatters.tsx"),Z=a("./app/utils/performance/segmentExplorer/segmentExplorerQuery.tsx"),_=a("./app/utils/queryString.tsx"),C=a("./app/utils/tokenizeSearch.tsx"),b=a("./app/views/eventsV2/table/cellAction.tsx"),S=a("./app/views/performance/utils.tsx"),T=a("./app/views/performance/transactionSummary/transactionTags/utils.tsx"),q=a("./app/views/performance/transactionSummary/filter.tsx"),z=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const V="tags_cursor",j=[{key:"key",field:"key",name:"Tag Key",width:-1,column:{kind:"field"}},{key:"tagValue",field:"tagValue",name:"Tag Values",width:-1,column:{kind:"field"}},{key:"aggregate",field:"aggregate",name:"Avg Duration",width:-1,column:{kind:"field"},canSort:!0},{key:"frequency",field:"frequency",name:"Frequency",width:-1,column:{kind:"field"},canSort:!0},{key:"comparison",field:"comparison",name:"Compared To Avg",width:-1,column:{kind:"field"},canSort:!0},{key:"sumdelta",field:"sumdelta",name:"Total Time Lost",width:-1,column:{kind:"field"},canSort:!0}],E={[q.f1.Browser]:"spans.browser",[q.f1.Http]:"spans.http",[q.f1.Db]:"spans.db",[q.f1.Resource]:"spans.resource"},K=(e,t,a)=>{const r=E[e];return r||((0,S.C$)(t,a)===S.iy.FRONTEND?"measurements.lcp":"transaction.duration")};function N(e){return(0,z.tZ)("div",{className:"truncate",children:e.row.tags_value})}N.displayName="TagValue";class D extends o.Component{constructor(...e){super(...e),(0,r.Z)(this,"state",{widths:[]}),(0,r.Z)(this,"handleResizeColumn",((e,t)=>{const a=[...this.state.widths];a[e]=t.width?Number(t.width):p.z7,this.setState({widths:a})})),(0,r.Z)(this,"getColumnOrder",(e=>{const{widths:t}=this.state;return e.map(((e,a)=>"number"==typeof t[a]?{...e,width:t[a]}:e))})),(0,r.Z)(this,"renderHeadCellWithMeta",((e,t,a)=>(r,n)=>this.renderHeadCell(e,t,r,a[n]))),(0,r.Z)(this,"handleTagValueClick",((e,t,a)=>{const{organization:r}=this.props;(0,v.ec)({eventKey:"performance_views.summary.tag_explorer.tag_value",eventName:"Performance Views: Tag Explorer Value Clicked",organization_id:parseInt(r.id,10)});const n=(0,_.ro)(e.query.query),o=(0,C.aI)(n||"");o.addFilterValues(t,[a]);const i=o.formatString();s.browserHistory.push({pathname:e.pathname,query:{...e.query,query:String(i).trim()}})})),(0,r.Z)(this,"handleCellAction",((e,t,a)=>r=>{const{eventView:n,location:o,organization:i}=this.props;(0,v.ec)({eventKey:"performance_views.summary.tag_explorer.cell_action",eventName:"Performance Views: Tag Explorer Cell Action Clicked",organization_id:parseInt(i.id,10)});const l=(0,C.aI)(n.query);l.removeFilter("event.type"),(0,b.rh)(l,r,{...e,name:a.id},t),s.browserHistory.push({pathname:o.pathname,query:{...o.query,[V]:void 0,query:l.formatString()}})})),(0,r.Z)(this,"renderBodyCell",((e,t,a)=>{const r=a[t.key],{location:n,organization:o,transactionName:s}=e;if("key"===t.key){const e=(0,T.vG)({orgSlug:o.slug,transaction:s,projectID:(0,_.ro)(n.query.project),query:{...n.query,tagKey:a.tags_key}});return(0,z.tZ)(i.Z,{features:["performance-tag-page"],organization:o,children:({hasFeature:t})=>t?(0,z.tZ)(m.Z,{to:e,onClick:()=>this.onTagKeyClick(),children:a.tags_key}):a.tags_key})}const l=[b.eX.ADD,b.eX.EXCLUDE];if("tagValue"===t.key){const e={...a,id:a.tags_key};return(0,z.tZ)(b.ZP,{column:t,dataRow:e,handleCellAction:this.handleCellAction(t,a.tags_value,e),allowActions:l,children:(0,z.tZ)(i.Z,{features:["performance-tag-page"],organization:o,children:({hasFeature:e})=>e?(0,z.tZ)("div",{className:"truncate",children:a.tags_value}):(0,z.tZ)(m.Z,{to:"",onClick:()=>this.handleTagValueClick(n,a.tags_key,a.tags_value),children:(0,z.tZ)(N,{row:a})})})})}if("frequency"===t.key)return(0,z.tZ)(A,{children:(0,w.rl)(a.frequency,0)});if("comparison"===t.key){const e=a.comparison,t=(0,w.rl)(e-1,0);return(0,z.tZ)(A,{children:e>1?(0,h.t)("+%s slower",t):(0,h.t)("%s faster",t)})}return"aggregate"===t.key?(0,z.tZ)(A,{children:(0,z.tZ)(S.Xr,{abbreviation:!0,milliseconds:a.aggregate})}):"sumdelta"===t.key?(0,z.tZ)(A,{children:(0,z.tZ)(S.Xr,{abbreviation:!0,milliseconds:a.sumdelta})}):r})),(0,r.Z)(this,"renderBodyCellWithData",(e=>(t,a)=>this.renderBodyCell(e,t,a)))}onSortClick(e,t){const{organization:a}=this.props;(0,v.ec)({eventKey:"performance_views.summary.tag_explorer.sort",eventName:"Performance Views: Tag Explorer Sorted",organization_id:parseInt(a.id,10),field:t,direction:e})}renderHeadCell(e,t,a,r){const{location:n}=this.props,o=(0,k.qG)(a.key,a.type,t),s={field:a.key,width:a.width},i=e.sortForField(s,t),l=(0,x.M3)(s,t),c=i?i.kind:void 0,d=i?i.field:void 0;return(0,z.tZ)(g.Z,{align:o,title:r.name,direction:c,canSort:l,generateSortLink:function(){if(!t)return;const a=e.sortOnField(s,t),{sort:r}=a.generateQueryStringObject();return{...n,query:{...n.query,[V]:void 0,tagSort:r}}},onClick:()=>this.onSortClick(c,d)})}onTagKeyClick(){const{organization:e}=this.props;(0,v.ec)({eventKey:"performance_views.summary.tag_explorer.visit_tag_key",eventName:"Performance Views: Tag Explorer - Visit Tag Key",organization_id:parseInt(e.id,10)})}render(){var e,t;const{eventView:a,organization:r,location:n,currentFilter:s,projects:i,transactionName:c}=this.props,d=(0,_.ro)(null===(e=n.query)||void 0===e?void 0:e.tagSort),u=(0,_.ro)(null===(t=n.query)||void 0===t?void 0:t.tags_cursor),g=a.clone();g.fields=j;const m=(0,x.vp)(d),y=g.withSorts(m.length?m:[{field:"sumdelta",kind:"desc"}]),h=K(s,i,y),f=((e,t,a)=>{const r=j.map((e=>({...e}))),n=r.find((e=>"aggregate"===e.key));return n?E[e]?(n.name="Avg Span Duration",r):(0,S.C$)(t,a)===S.iy.FRONTEND?(n.name="Avg LCP",r):r:r})(s,i,y),v=this.getColumnOrder(f),k=y.getSorts();return(0,z.tZ)(Z.Z,{eventView:y,orgSlug:r.slug,location:n,aggregateColumn:h,limit:5,cursor:u,children:({isLoading:e,tableData:t,pageLinks:a})=>(0,z.BX)(o.Fragment,{children:[(0,z.tZ)(l.n,{target:"tag_explorer",children:(0,z.tZ)(P,{transactionName:c,location:n,organization:r,pageLinks:a})}),(0,z.tZ)(p.ZP,{isLoading:e,data:t&&t.data?t.data:[],columnOrder:v,columnSortBy:k,grid:{renderHeadCell:this.renderHeadCellWithMeta(y,(null==t?void 0:t.meta)||{},f),renderBodyCell:this.renderBodyCellWithData(this.props),onResizeColumn:this.handleResizeColumn},location:n})]})})}}function P(e){const{pageLinks:t,organization:a,location:r,transactionName:n}=e,o=(0,T.vG)({orgSlug:a.slug,transaction:n,projectID:(0,_.ro)(r.query.project),query:{...r.query}});return(0,z.BX)(F,{children:[(0,z.BX)("div",{children:[(0,z.tZ)(d.OT,{children:(0,h.t)("Suspect Tags")}),(0,z.tZ)(u.Z,{type:"beta"})]}),(0,z.tZ)(i.Z,{features:["performance-tag-page"],organization:a,children:(0,z.tZ)(c.ZP,{onClick:()=>{(0,v.ec)({eventKey:"performance_views.summary.tag_explorer.change_page",eventName:"Performance Views: Tag Explorer Change Page",organization_id:parseInt(a.id,10)})},to:o,size:"small","data-test-id":"tags-explorer-open-tags",children:(0,h.t)("View All Tags")})}),(0,z.tZ)(B,{pageLinks:t,onCursor:(e,t,r)=>{(0,v.ec)({eventKey:"performance_views.summary.tag_explorer.change_page",eventName:"Performance Views: Tag Explorer Change Page",organization_id:parseInt(a.id,10)}),s.browserHistory.push({pathname:t,query:{...r,[V]:e}})},size:"small"})]})}D.displayName="_TagExplorer",P.displayName="TagsHeader";const A=(0,n.Z)("div",{target:"euaybo32"})({name:"2qga7i",styles:"text-align:right"}),F=(0,n.Z)("div",{target:"euaybo31"})("display:grid;grid-template-columns:1fr auto auto;margin-bottom:",(0,f.Z)(1),";"),B=(0,n.Z)(y.Z,{target:"euaybo30"})("margin:0 0 0 ",(0,f.Z)(1),";"),I=D}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_transactionSummary_tagExplorer_tsx.3c05aa5b4ffff68d617c277dd39cdb2f.js.map