"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_organizationGroupDetails_index_tsx"],{"./app/utils/recreateRoute.tsx":(t,e,s)=>{s.d(e,{Z:()=>i});var o=s("../node_modules/lodash/findLastIndex.js"),r=s.n(o),n=s("./app/utils/replaceRouterParams.tsx");function i(t,e){var s,o;const{routes:i,params:a,location:p,stepBack:l}=e,u=i.map((({path:t})=>t||""));let c,d;"string"!=typeof t?(d=i.indexOf(t)+1,c=r()(u.slice(0,d),(t=>"/"===t[0]))):c=r()(u,(t=>"/"===t[0]));let h=u.slice(c,d);void 0!==l&&(h=h.slice(0,l));const g=null!==(s=null==p?void 0:p.search)&&void 0!==s?s:"",m=null!==(o=null==p?void 0:p.hash)&&void 0!==o?o:"",v="".concat(h.join("")).concat("string"!=typeof t?"":t).concat(g).concat(m);return(0,n.Z)(v,a)}},"./app/views/organizationGroupDetails/index.tsx":(t,e,s)=>{s.r(e),s.d(e,{default:()=>q});var o=s("../node_modules/react/index.js"),r=s("./app/utils/analytics.tsx"),n=s("./app/utils/withGlobalSelection.tsx"),i=s("./app/utils/withOrganization.tsx"),a=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),p=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.string.replace.js"),s("../node_modules/react-document-title/index.js")),l=s.n(p),u=s("../node_modules/react-router/es/index.js"),c=s("../node_modules/@sentry/minimal/esm/index.js"),d=s("../node_modules/@sentry/react/esm/profiler.js"),h=s("../node_modules/prop-types/index.js"),g=s.n(h),m=s("./app/components/loadingError.tsx"),v=s("./app/components/loadingIndicator.tsx"),E=s("./app/components/organizations/globalSelectionHeader/index.tsx"),f=s("./app/components/projects/missingProjectMembership.tsx"),y=s("./app/locale.tsx"),I=s("./app/sentryTypes.tsx"),R=s("./app/stores/groupStore.tsx"),j=s("./app/styles/organization.tsx"),S=s("./app/utils/callIfFunction.tsx"),x=s("./app/utils/events.tsx"),Z=s("./app/utils/projects.tsx"),T=s("./app/utils/recreateRoute.tsx"),b=s("./app/utils/withApi.tsx");const w="GROUP_NOT_FOUND",C="MISSING_MEMBERSHIP";var G=s("./app/views/organizationGroupDetails/header.tsx"),_=s("./app/views/organizationGroupDetails/utils.tsx"),D=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class P extends o.Component{constructor(...t){super(...t),(0,a.Z)(this,"state",this.initialState),(0,a.Z)(this,"remountComponent",(()=>{this.setState(this.initialState),this.fetchData()})),(0,a.Z)(this,"refetchGroup",(async()=>{const{loadingGroup:t,loading:e,loadingEvent:s,group:o}=this.state;if((null==o?void 0:o.status)!==_.m7.REPROCESSING||t||e||s)return;const{api:r}=this.props;this.setState({loadingGroup:!0});try{const t=await r.requestPromise(this.groupDetailsEndpoint,{query:this.getGroupQuery()}),e=this.getReprocessingNewRoute(t);if(e)return void u.browserHistory.push(e);this.setState({group:t,loadingGroup:!1})}catch(t){this.handleRequestError(t)}})),(0,a.Z)(this,"listener",R.Z.listen((t=>this.onGroupChange(t)),void 0)),(0,a.Z)(this,"interval",void 0)}getChildContext(){return{group:this.state.group,location:this.props.location}}componentDidMount(){this.fetchData(),this.updateReprocessingProgress()}componentDidUpdate(t,e){var s,o;t.isGlobalSelectionReady===this.props.isGlobalSelectionReady&&t.location.pathname===this.props.location.pathname||this.fetchData(),(!this.canLoadEventEarly(t)&&(null==e||!e.group)&&this.state.group||(null===(s=t.params)||void 0===s?void 0:s.eventId)!==(null===(o=this.props.params)||void 0===o?void 0:o.eventId)&&this.state.group)&&this.getEvent(this.state.group)}componentWillUnmount(){R.Z.reset(),(0,S.g)(this.listener),this.interval&&clearInterval(this.interval)}get initialState(){return{group:null,loading:!0,loadingEvent:!0,loadingGroup:!0,error:!1,eventError:!1,errorType:null,project:null}}canLoadEventEarly(t){return!t.params.eventId||["oldest","latest"].includes(t.params.eventId)}get groupDetailsEndpoint(){return"/issues/".concat(this.props.params.groupId,"/")}get groupReleaseEndpoint(){return"/issues/".concat(this.props.params.groupId,"/first-last-release/")}async getEvent(t){var e;t&&this.setState({loadingEvent:!0,eventError:!1});const{params:s,environments:o,api:r}=this.props,n=s.orgId,i=s.groupId,a=(null==s?void 0:s.eventId)||"latest",p=null==t||null===(e=t.project)||void 0===e?void 0:e.slug;try{const t=await(0,_.MN)(r,n,i,a,o,p);this.setState({event:t,loading:!1,eventError:!1,loadingEvent:!1})}catch(t){c.Tb(t),this.setState({eventError:!0,loading:!1,loadingEvent:!1})}}getCurrentRouteInfo(t){const{routes:e,organization:s}=this.props,{event:o}=this.state,{currentTab:r,isEventRoute:n}=e[e.length-1].props;return{currentTab:r,baseUrl:n&&o?"/organizations/".concat(s.slug,"/issues/").concat(t.id,"/events/").concat(o.id,"/"):"/organizations/".concat(s.slug,"/issues/").concat(t.id,"/")}}updateReprocessingProgress(){this.hasReprocessingV2Feature()&&(this.interval=setInterval(this.refetchGroup,3e4))}hasReprocessingV2Feature(){var t;const{organization:e}=this.props;return null===(t=e.features)||void 0===t?void 0:t.includes("reprocessing-v2")}getReprocessingNewRoute(t){const{routes:e,location:s,params:o}=this.props,{groupId:r}=o,{id:n}=t,i=this.hasReprocessingV2Feature(),a=(0,_.M3)(t),{currentTab:p,baseUrl:l}=this.getCurrentRouteInfo(t);if(r!==n)return i&&a===_.m7.REPROCESSED_AND_HASNT_EVENT&&p!==G.Mf.ACTIVITY?{pathname:"".concat(l).concat(G.Mf.ACTIVITY,"/"),query:{...o,groupId:n}}:(0,T.Z)("",{routes:e,location:s,params:{...o,groupId:n}});if(i){if(a===_.m7.REPROCESSING&&p!==G.Mf.DETAILS)return{pathname:l,query:o};if(a===_.m7.REPROCESSED_AND_HASNT_EVENT&&p!==G.Mf.ACTIVITY&&p!==G.Mf.USER_FEEDBACK)return{pathname:"".concat(l).concat(G.Mf.ACTIVITY,"/"),query:o}}}getGroupQuery(){const{environments:t}=this.props;return{...t?{environment:t}:{},expand:"inbox",collapse:"release"}}getFetchDataRequestErrorType(t){return t?404===t?w:403===t?C:null:null}handleRequestError(t){c.Tb(t);const e=this.getFetchDataRequestErrorType(null==t?void 0:t.status);this.setState({loadingGroup:!1,loading:!1,error:!0,errorType:e})}async fetchGroupReleases(){const{api:t}=this.props,e=await t.requestPromise(this.groupReleaseEndpoint);R.Z.onPopulateReleases(this.props.params.groupId,e)}async fetchData(){const{api:t,isGlobalSelectionReady:e,params:s}=this.props;if(e)try{const e=this.canLoadEventEarly(this.props)?this.getEvent():void 0,o=await t.requestPromise(this.groupDetailsEndpoint,{query:this.getGroupQuery()}),[r]=await Promise.all([o,e]);this.fetchGroupReleases();const n=this.getReprocessingNewRoute(r);if(n)return void u.browserHistory.push(n);const i=r.project;if((0,_.V7)(t,s.orgId,i.slug,s.groupId),i){const t={...this.props.location};void 0===t.query.project&&void 0===t.query._allp&&(t.query.project=i.id),delete t.query._allp,u.browserHistory.replace(t)}else c.$e((()=>{c.Tb(new Error("Project not found"))}));this.setState({project:i,loadingGroup:!1}),R.Z.loadInitialData([r])}catch(t){this.handleRequestError(t)}}onGroupChange(t){const e=this.props.params.groupId;if(t.has(e)){const t=R.Z.get(e);if(t){if(t.stale)return void this.fetchData();this.setState({group:t})}}}getTitle(){const{organization:t}=this.props,{group:e}=this.state,s="Sentry";if(!e)return s;const{title:o}=(0,x.YQ)(e,null==t?void 0:t.features),r=(0,x.FC)(e),{project:n}=e,i="".concat(t.slug," - ").concat(n.slug);return o&&r?"".concat(o,": ").concat(r," - ").concat(i):"".concat(o||r||s," - ").concat(i)}renderError(){var t,e;const{organization:s,location:o}=this.props,r=null!==(t=s.projects)&&void 0!==t?t:[],n=o.query.project,i=null===(e=r.find((t=>t.id===n)))||void 0===e?void 0:e.slug;switch(this.state.errorType){case w:return(0,D.tZ)(m.Z,{message:(0,y.t)("The issue you were looking for was not found.")});case C:return(0,D.tZ)(f.Z,{organization:this.props.organization,projectSlug:i});default:return(0,D.tZ)(m.Z,{onRetry:this.remountComponent})}}renderContent(t,e){const{children:s,environments:r}=this.props,{loadingEvent:n,eventError:i,event:a}=this.state,{currentTab:p,baseUrl:l}=this.getCurrentRouteInfo(e),u=(0,_.M3)(e);let c={environments:r,group:e,project:t};return p===G.Mf.DETAILS&&(c={...c,event:a,loadingEvent:n,eventError:i,groupReprocessingStatus:u,onRetry:()=>this.remountComponent()}),p===G.Mf.TAGS&&(c={...c,event:a,baseUrl:l}),(0,D.BX)(o.Fragment,{children:[(0,D.tZ)(G.ZP,{groupReprocessingStatus:u,project:t,event:a,group:e,currentTab:p,baseUrl:l}),o.isValidElement(s)?o.cloneElement(s,c):s]})}renderPageContent(){var t;const{error:e,group:s,project:o,loading:r}=this.state;if(r||!s&&!e)return(0,D.tZ)(v.Z,{});if(e)return this.renderError();const{organization:n}=this.props;return(0,D.tZ)(Z.Z,{orgId:n.slug,slugs:[null!==(t=null==o?void 0:o.slug)&&void 0!==t?t:""],"data-test-id":"group-projects-container",children:({projects:t,initiallyLoaded:e,fetchError:o})=>e?o?(0,D.tZ)(m.Z,{message:(0,y.t)("Error loading the specified project")}):this.renderContent(t[0],s):(0,D.tZ)(v.Z,{})})}render(){const{project:t}=this.state;return(0,D.tZ)(l(),{title:this.getTitle(),children:(0,D.tZ)(E.Z,{skipLoadLastUsed:!0,forceProject:t,showDateSelector:!1,shouldForceProject:!0,lockedMessageSubject:(0,y.t)("issue"),showIssueStreamLink:!0,showProjectSettingsLink:!0,children:(0,D.tZ)(j.JH,{children:this.renderPageContent()})})})}}P.displayName="GroupDetails",(0,a.Z)(P,"childContextTypes",{group:I.Z.Group,location:g().object});const z=(0,b.Z)(d.zH(P));class M extends o.Component{constructor(t){super(t),this.startMetricCollection()}componentDidMount(){(0,r.co)("issue_page.viewed",{group_id:parseInt(this.props.params.groupId,10),org_id:parseInt(this.props.organization.id,10)})}startMetricCollection(){const t=(0,i.D)(this.props.organization)?"cold-start":"warm-start";r.oF.mark({name:"page-issue-details-start",data:{start_type:t}})}render(){const{selection:t,...e}=this.props;return(0,D.tZ)(z,{environments:t.environments,...e},"".concat(this.props.params.groupId,"-envs:").concat(t.environments.join(",")))}}M.displayName="OrganizationGroupDetails";const q=(0,i.Z)((0,n.Z)(M))}}]);
//# sourceMappingURL=../sourcemaps/app_views_organizationGroupDetails_index_tsx.a5ef1170d4ec136b174a70446b0e0801.js.map