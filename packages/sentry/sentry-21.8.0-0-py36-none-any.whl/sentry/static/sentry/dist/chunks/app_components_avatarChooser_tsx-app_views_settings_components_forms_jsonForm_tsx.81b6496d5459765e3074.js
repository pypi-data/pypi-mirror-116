"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_components_avatarChooser_tsx-app_views_settings_components_forms_jsonForm_tsx"],{"./app/components/avatarChooser.tsx":(e,t,s)=>{s.d(t,{Z:()=>C});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),n=s("./app/actionCreators/indicator.tsx"),r=s("./app/components/avatar/index.tsx");s("../node_modules/core-js/modules/web.url.js");const l=(0,a.Z)("div",{target:"e1tfl33i0"})("border:1px solid ",(e=>e.theme.border),";box-shadow:none;background:",(e=>e.theme.backgroundSecondary),";padding:",(e=>e.hasImage?"80px 30px":"15px 20px"),";margin-bottom:20px;border-radius:3px;",(e=>e.centered&&"text-align: center"),";");var d=s("./app/constants/index.tsx"),p=s("./app/locale.tsx"),c=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const h={nw:["top","left"],ne:["top","right"],se:["bottom","right"],sw:["bottom","left"]};class m extends o.Component{constructor(...e){super(...e),(0,i.Z)(this,"state",{file:null,objectURL:null,mousePosition:{pageX:0,pageY:0},resizeDimensions:{top:0,left:0,size:0},resizeDirection:null}),(0,i.Z)(this,"file",o.createRef()),(0,i.Z)(this,"canvas",o.createRef()),(0,i.Z)(this,"image",o.createRef()),(0,i.Z)(this,"cropContainer",o.createRef()),(0,i.Z)(this,"MIN_DIMENSION",256),(0,i.Z)(this,"MAX_DIMENSION",1024),(0,i.Z)(this,"ALLOWED_MIMETYPES","image/gif,image/jpeg,image/png"),(0,i.Z)(this,"onSelectFile",(e=>{const t=e.target.files&&e.target.files[0];if(!t)return;if(!/^image\//.test(t.type))return void(0,n.Iw)((0,p.t)("That is not a supported file type."));this.revokeObjectUrl();const{updateDataUrlState:s}=this.props,i=window.URL.createObjectURL(t);this.setState({file:t,objectURL:i},(()=>s({savedDataUrl:null})))})),(0,i.Z)(this,"revokeObjectUrl",(()=>this.state.objectURL&&window.URL.revokeObjectURL(this.state.objectURL))),(0,i.Z)(this,"onImageLoad",(()=>{const e=this.validateImage();if(e)return this.revokeObjectUrl(),this.setState({objectURL:null}),void(0,n.Iw)(e);const t=this.image.current;if(!t)return;const s={resizeDimensions:{size:Math.min(t.clientHeight,t.clientWidth),top:0,left:0}};this.setState(s,this.drawToCanvas)})),(0,i.Z)(this,"updateDimensions",(e=>{const t=this.cropContainer.current;if(!t)return;const{mousePosition:s,resizeDimensions:i}=this.state;let a=e.pageY,o=e.pageX,n=i.top+(a-s.pageY),r=i.left+(o-s.pageX);n<0?(n=0,a=s.pageY):n+i.size>t.clientHeight&&(n=t.clientHeight-i.size,a=s.pageY),r<0?(r=0,o=s.pageX):r+i.size>t.clientWidth&&(r=t.clientWidth-i.size,o=s.pageX),this.setState((e=>({resizeDimensions:{...e.resizeDimensions,top:n,left:r},mousePosition:{pageX:o,pageY:a}})))})),(0,i.Z)(this,"onMouseDown",(e=>{e.preventDefault(),this.setState({mousePosition:{pageY:e.pageY,pageX:e.pageX}}),document.addEventListener("mousemove",this.updateDimensions),document.addEventListener("mouseup",this.onMouseUp)})),(0,i.Z)(this,"onMouseUp",(e=>{e.preventDefault(),document.removeEventListener("mousemove",this.updateDimensions),document.removeEventListener("mouseup",this.onMouseUp),this.drawToCanvas()})),(0,i.Z)(this,"startResize",((e,t)=>{t.stopPropagation(),t.preventDefault(),document.addEventListener("mousemove",this.updateSize),document.addEventListener("mouseup",this.stopResize),this.setState({resizeDirection:e,mousePosition:{pageY:t.pageY,pageX:t.pageX}})})),(0,i.Z)(this,"stopResize",(e=>{e.stopPropagation(),e.preventDefault(),document.removeEventListener("mousemove",this.updateSize),document.removeEventListener("mouseup",this.stopResize),this.setState({resizeDirection:null}),this.drawToCanvas()})),(0,i.Z)(this,"updateSize",(e=>{const t=this.cropContainer.current;if(!t)return;const{mousePosition:s}=this.state,i=e.pageY-s.pageY,a=e.pageX-s.pageX;this.setState({resizeDimensions:this.getNewDimensions(t,i,a),mousePosition:{pageX:e.pageX,pageY:e.pageY}})})),(0,i.Z)(this,"getDiffNW",((e,t)=>(e-2*e+(t-2*t))/2)),(0,i.Z)(this,"getDiffNE",((e,t)=>(e-2*e+t)/2)),(0,i.Z)(this,"getDiffSW",((e,t)=>(e+(t-2*t))/2)),(0,i.Z)(this,"getDiffSE",((e,t)=>(e+t)/2)),(0,i.Z)(this,"getNewDimensions",((e,t,s)=>{const{resizeDimensions:i,resizeDirection:a}=this.state,o=this["getDiff"+a.toUpperCase()](t,s);let n=e.clientHeight-i.top,r=e.clientWidth-i.left;const l="nw"===a||"ne"===a,d="nw"===a||"sw"===a,p={top:0,left:0,size:i.size+o};l&&(p.top=i.top-o,n=e.clientHeight-p.top),d&&(p.left=i.left-o,r=e.clientWidth-p.left),p.top<0&&(p.size=p.size+p.top,d&&(p.left=p.left-p.top),p.top=0),p.left<0&&(p.size=p.size+p.left,l&&(p.top=p.top-p.left),p.left=0);const c=Math.min(r,n);return p.size>c?(l&&(p.top=p.top+p.size-c),d&&(p.left=p.left+p.size-c),p.size=c):p.size<this.MIN_DIMENSION&&(l&&(p.top=p.top+p.size-this.MIN_DIMENSION),d&&(p.left=p.left+p.size-this.MIN_DIMENSION),p.size=this.MIN_DIMENSION),{...i,...p}})),(0,i.Z)(this,"uploadClick",(e=>{e.preventDefault(),this.file.current&&this.file.current.click()}))}componentWillUnmount(){this.revokeObjectUrl()}validateImage(){const e=this.image.current;return e?e.naturalWidth<this.MIN_DIMENSION||e.naturalHeight<this.MIN_DIMENSION?(0,p._N)("Please upload an image larger than [size]px by [size]px.",{size:this.MIN_DIMENSION-1}):e.naturalWidth>this.MAX_DIMENSION||e.naturalHeight>this.MAX_DIMENSION?(0,p._N)("Please upload an image smaller than [size]px by [size]px.",{size:this.MAX_DIMENSION}):null:null}drawToCanvas(){const e=this.canvas.current;if(!e)return;const t=this.image.current;if(!t)return;const{left:s,top:i,size:a}=this.state.resizeDimensions,o=(t.naturalHeight/t.clientHeight+t.naturalWidth/t.clientWidth)/2;e.width=a*o,e.height=a*o,e.getContext("2d").drawImage(t,s*o,i*o,a*o,a*o,0,0,a*o,a*o),this.props.updateDataUrlState({dataUrl:e.toDataURL()})}get imageSrc(){var e;const{savedDataUrl:t,model:s,type:i}=this.props,a=null===(e=s.avatar)||void 0===e?void 0:e.avatarUuid,o=a&&"/".concat(d.f6[i]||"avatar","/").concat(a,"/");return t||this.state.objectURL||o}renderImageCrop(){const e=this.imageSrc;if(!e)return null;const{resizeDimensions:t,resizeDirection:s}=this.state,i={top:t.top,left:t.left,width:t.size,height:t.size};return(0,c.tZ)(v,{resizeDirection:s,children:(0,c.BX)(f,{ref:this.cropContainer,children:[(0,c.tZ)("img",{ref:this.image,src:e,onLoad:this.onImageLoad,onDragStart:e=>e.preventDefault()}),(0,c.tZ)(b,{style:i,onMouseDown:this.onMouseDown,children:Object.keys(h).map((e=>(0,c.tZ)(x,{position:e,onMouseDown:this.startResize.bind(this,e)},e)))})]})})}render(){const e=this.imageSrc,t=(0,c.tZ)("a",{onClick:this.uploadClick}),s=(0,c.tZ)(l,{hasImage:!0,centered:!0,children:(0,c.tZ)("p",{children:(0,p._N)("[upload:Upload a photo] to get started.",{upload:t})})});return(0,c.BX)(o.Fragment,{children:[!e&&s,e&&(0,c.tZ)(Z,{ref:this.canvas}),this.renderImageCrop(),(0,c.BX)("div",{className:"form-group",children:[e&&(0,c.tZ)("a",{onClick:this.uploadClick,children:(0,p.t)("Change Photo")}),(0,c.tZ)(g,{ref:this.file,type:"file",accept:this.ALLOWED_MIMETYPES,onChange:this.onSelectFile})]})]})}}m.displayName="AvatarCropper";const u=m,g=(0,a.Z)("input",{target:"e12i7tw55"})({name:"1trwphv",styles:"position:absolute;opacity:0"}),v=(0,a.Z)("div",{target:"e12i7tw54"})("cursor:",(e=>e.resizeDirection?"".concat(e.resizeDirection,"-resize"):"default"),";text-align:center;margin-bottom:20px;background-size:20px 20px;background-position:0 0,0 10px,10px -10px,-10px 0px;background-color:",(e=>e.theme.background),";background-image:linear-gradient(\n      45deg,\n      ",(e=>e.theme.backgroundSecondary)," 25%,\n      rgba(0, 0, 0, 0) 25%\n    ),linear-gradient(-45deg, ",(e=>e.theme.backgroundSecondary)," 25%, rgba(0, 0, 0, 0) 25%),linear-gradient(45deg, rgba(0, 0, 0, 0) 75%, ",(e=>e.theme.backgroundSecondary)," 75%),linear-gradient(-45deg, rgba(0, 0, 0, 0) 75%, ",(e=>e.theme.backgroundSecondary)," 75%);"),f=(0,a.Z)("div",{target:"e12i7tw53"})({name:"nycxdm",styles:"display:inline-block;position:relative;max-width:100%"}),b=(0,a.Z)("div",{target:"e12i7tw52"})("position:absolute;border:2px dashed ",(e=>e.theme.gray300),";"),x=(0,a.Z)("div",{target:"e12i7tw51"})("border-radius:5px;width:10px;height:10px;position:absolute;background-color:",(e=>e.theme.gray300),";cursor:",(e=>"".concat(e.position,"-resize")),";",(e=>h[e.position].map((e=>"".concat(e,": -5px;")))),";"),Z=(0,a.Z)("canvas",{target:"e12i7tw50"})({name:"eivff4",styles:"display:none"});var y=s("./app/components/button.tsx"),D=s("./app/components/links/externalLink.tsx"),S=s("./app/components/loadingError.tsx"),w=s("./app/components/loadingIndicator.tsx"),z=s("./app/components/panels/index.tsx"),_=s("./app/utils/withApi.tsx"),N=s("./app/views/settings/components/forms/controls/radioGroup.tsx");class I extends o.Component{constructor(...e){super(...e),(0,i.Z)(this,"state",{model:this.props.model,savedDataUrl:null,dataUrl:null,hasError:!1}),(0,i.Z)(this,"handleSaveSettings",(e=>{const{endpoint:t,api:s}=this.props,{model:i,dataUrl:a}=this.state;e.preventDefault();let o={};const n=i&&i.avatar?i.avatar.avatarType:void 0;o={avatar_photo:a?a.split(",")[1]:void 0,avatar_type:n},s.request(t,{method:"PUT",data:o,success:e=>{this.setState({savedDataUrl:this.state.dataUrl}),this.handleSuccess(e)},error:this.handleError.bind(this,"There was an error saving your preferences.")})})),(0,i.Z)(this,"handleChange",(e=>{var t,s;return this.updateState({...this.state.model,avatar:{avatarUuid:null!==(t=null===(s=this.state.model.avatar)||void 0===s?void 0:s.avatarUuid)&&void 0!==t?t:"",avatarType:e}})}))}UNSAFE_componentWillReceiveProps(e){void 0!==e.model&&this.setState({model:e.model})}updateState(e){this.setState({model:e})}handleError(e){(0,n.Iw)(e)}handleSuccess(e){const{onSave:t}=this.props;this.setState({model:e}),t(e),(0,n.S9)((0,p.t)("Successfully saved avatar preferences"))}render(){var e,t;const{allowGravatar:s,allowUpload:i,allowLetter:a,savedDataUrl:o,type:n,isUser:d,disabled:h}=this.props,{hasError:m,model:g}=this.state;if(m)return(0,c.tZ)(S.Z,{});if(!g)return(0,c.tZ)(w.Z,{});const v=null!==(e=null===(t=g.avatar)||void 0===t?void 0:t.avatarType)&&void 0!==e?e:"letter_avatar",f="letter_avatar"===v,b="team"===n,x="organization"===n,Z=[];return a&&Z.push(["letter_avatar",(0,p.t)("Use initials")]),i&&Z.push(["upload",(0,p.t)("Upload an image")]),s&&Z.push(["gravatar",(0,p.t)("Use Gravatar")]),(0,c.BX)(z.s_,{children:[(0,c.tZ)(z.V9,{children:(0,p.t)("Avatar")}),(0,c.tZ)(z.N,{children:(0,c.BX)(j,{children:[(0,c.BX)(U,{inline:f,children:[(0,c.tZ)(N.Z,{style:{flex:1},choices:Z,value:v,label:(0,p.t)("Avatar Type"),onChange:this.handleChange,disabled:h}),f&&(0,c.tZ)(r.Z,{gravatar:!1,style:{width:90,height:90},user:d?g:void 0,organization:x?g:void 0,team:b?g:void 0})]}),(0,c.BX)(P,{children:[s&&"gravatar"===v&&(0,c.BX)(l,{children:[(0,p.t)("Gravatars are managed through "),(0,c.tZ)(D.Z,{href:"http://gravatar.com",children:"Gravatar.com"})]}),g.avatar&&"upload"===v&&(0,c.tZ)(u,{...this.props,type:n,model:g,savedDataUrl:o,updateDataUrlState:e=>this.setState(e)}),(0,c.tZ)(M,{className:"form-actions",children:(0,c.tZ)(y.ZP,{type:"button",priority:"primary",onClick:this.handleSaveSettings,disabled:h,children:(0,p.t)("Save Avatar")})})]})]})})]})}}I.displayName="AvatarChooser",(0,i.Z)(I,"defaultProps",{allowGravatar:!0,allowLetter:!0,allowUpload:!0,type:"user",onSave:()=>{}});const U=(0,a.Z)("div",{target:"ecp1fla3"})("display:flex;flex-direction:",(e=>e.inline?"row":"column"),";"),j=(0,a.Z)("div",{target:"ecp1fla2"})({name:"kf1ytu",styles:"line-height:1.5em;padding:1em 1.25em"}),M=(0,a.Z)("fieldset",{target:"ecp1fla1"})({name:"1dbk00x",styles:"display:flex;justify-content:flex-end;margin-top:1em"}),P=(0,a.Z)("div",{target:"ecp1fla0"})({name:"1blj7km",styles:"margin-top:1em"}),C=(0,_.Z)(I)},"./app/views/settings/components/forms/formPanel.tsx":(e,t,s)=>{s.d(t,{Z:()=>d});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("../node_modules/react/index.js"),o=s("./app/components/panels/index.tsx"),n=s("./app/utils/sanitizeQuerySelector.tsx"),r=s("./app/views/settings/components/forms/fieldFromConfig.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class d extends a.Component{render(){const{title:e,fields:t,access:s,disabled:i,additionalFieldProps:a,renderFooter:d,renderHeader:p,...c}=this.props;return(0,l.BX)(o.s_,{id:"string"==typeof e?(0,n.m)(e):void 0,children:[e&&(0,l.tZ)(o.V9,{children:e}),(0,l.BX)(o.N,{children:["function"==typeof p&&p({title:e,fields:t}),t.map((e=>{if("function"==typeof e)return e();const{defaultValue:t,...o}=e;return!0===i&&(o.disabled=!0,o.disabledReason=void 0),(0,l.tZ)(r.Z,{access:s,disabled:i,...c,...a,field:o,highlighted:this.props.highlighted==="#".concat(e.name)},e.name)})),"function"==typeof d&&d({title:e,fields:t})]})]})}}d.displayName="FormPanel",(0,i.Z)(d,"defaultProps",{additionalFieldProps:{}})},"./app/views/settings/components/forms/jsonForm.tsx":(e,t,s)=>{s.d(t,{Z:()=>u});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),o=s("../node_modules/react-router/es/index.js"),n=s("../node_modules/@sentry/minimal/esm/index.js"),r=s("../node_modules/scroll-to-element/index.js"),l=s.n(r),d=s("./app/utils.tsx"),p=s("./app/utils/sanitizeQuerySelector.tsx"),c=s("./app/views/settings/components/forms/formPanel.tsx"),h=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class m extends a.Component{constructor(...e){var t;super(...e),(0,i.Z)(this,"state",{highlighted:null===(t=this.props.location)||void 0===t?void 0:t.hash})}componentDidMount(){this.scrollToHash()}UNSAFE_componentWillReceiveProps(e){if(this.props.location.hash!==e.location.hash){const t=e.location.hash;this.scrollToHash(t),this.setState({highlighted:t})}}scrollToHash(e){var t;const s=e||(null===(t=this.props.location)||void 0===t?void 0:t.hash);if(s)try{l()((0,p.m)(decodeURIComponent(s)),{align:"middle",offset:-100})}catch(e){n.Tb(e)}}shouldDisplayForm(e){const t=e.filter((e=>"function"!=typeof e&&(0,d.ri)(null==e?void 0:e.visible)));if(e.length===t.length){const{additionalFieldProps:e,...s}=this.props;return!t.every((t=>"function"==typeof t.visible?!t.visible({...s,...e}):!t.visible))}return!0}renderForm({fields:e,formPanelProps:t,title:s}){return this.shouldDisplayForm(e)||null!=t&&t.renderFooter||null!=t&&t.renderHeader?(0,h.tZ)(c.Z,{title:s,fields:e,...t}):null}render(){const{access:e,fields:t,title:s,forms:i,disabled:o,features:n,additionalFieldProps:r,renderFooter:l,renderHeader:d,location:p,...c}=this.props,m={access:e,disabled:o,features:n,additionalFieldProps:r,renderFooter:l,renderHeader:d,highlighted:this.state.highlighted};return(0,h.BX)("div",{...c,children:[void 0!==i&&i.map(((e,t)=>(0,h.tZ)(a.Fragment,{children:this.renderForm({formPanelProps:m,...e})},t))),void 0===i&&void 0!==t&&this.renderForm({fields:t,formPanelProps:m,title:s})]})}}m.displayName="JsonForm";const u=(0,o.withRouter)(m)}}]);
//# sourceMappingURL=../sourcemaps/app_components_avatarChooser_tsx-app_views_settings_components_forms_jsonForm_tsx.13ff299c2d4fdeaeedc24484e88c0654.js.map