"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_utils_routeTitle_tsx-app_views_asyncView_tsx-app_views_releases_utils_releaseHealthRequest_tsx"],{"./app/utils/routeTitle.tsx":(e,t,s)=>{s.d(t,{Z:()=>o});const o=function(e,t,s=!0,o){const a="".concat(e," - ").concat(t),n=o?"".concat(a," - ").concat(o):a;return s?"".concat(n," - Sentry"):n}},"./app/views/asyncView.tsx":(e,t,s)=>{s.d(t,{Z:()=>i}),s("../node_modules/react/index.js");var o=s("../node_modules/react-document-title/index.js"),a=s.n(o),n=s("./app/components/asyncComponent.tsx"),r=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends n.Z{getTitle(){return""}render(){const e=this.getTitle();return(0,r.tZ)(a(),{title:"".concat(e?"".concat(e," - "):"","Sentry"),children:this.renderComponent()})}}i.displayName="AsyncView"},"./app/views/releases/list/utils.tsx":(e,t,s)=>{let o,a,n;s.d(t,{Y7:()=>o,zY:()=>a,L4:()=>n}),function(e){e.CRASH_FREE_USERS="crash_free_users",e.CRASH_FREE_SESSIONS="crash_free_sessions",e.USERS_24_HOURS="users_24h",e.SESSIONS_24_HOURS="sessions_24h",e.SESSIONS="sessions",e.DATE="date",e.BUILD="build",e.SEMVER="semver",e.ADOPTION="adoption"}(o||(o={})),function(e){e.USERS="users",e.SESSIONS="sessions"}(a||(a={})),function(e){e.ACTIVE="active",e.ARCHIVED="archived"}(n||(n={}))},"./app/views/releases/utils/index.tsx":(e,t,s)=>{s.d(t,{hf:()=>y,G5:()=>S,Mf:()=>g,zB:()=>f,r:()=>P,G$:()=>C,PS:()=>j,eY:()=>R,TB:()=>B,rF:()=>_,gs:()=>I,C8:()=>x,O7:()=>w}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var o=s("../node_modules/lodash/pick.js"),a=s.n(o),n=s("../node_modules/lodash/round.js"),r=s.n(n),i=s("../node_modules/moment/moment.js"),l=s.n(i),u=s("./app/components/organizations/globalSelectionHeader/getParams.tsx"),d=s("./app/constants/globalSelectionHeader.tsx"),c=s("./app/locale.tsx"),h=s("./app/types/index.tsx"),p=s("./app/utils/tokenizeSearch.tsx"),m=s("./app/views/issueList/utils.tsx"),v=s("./app/views/releases/list/utils.tsx");const y=95,S=e=>r()(e,e>60?0:3),g=(e,t=y,s=3)=>r()(e,e>t?s:0),f=(e,t=y,s=3)=>{if(isNaN(e))return"â€•";if(e<1&&e>0)return"<1%";const o=g(e,t,s).toLocaleString();return"".concat(o,"%")},P=(e,t=!0)=>r()(t?Math.abs(e):e,3),C=(e,t=!0)=>"".concat(P(e,t).toLocaleString(),"%"),j=(e,t,s)=>({pathname:"/organizations/".concat(e,"/issues/"),query:{project:t,statsPeriod:void 0,start:void 0,end:void 0,query:new p.an(["firstRelease:".concat(s)]).formatString(),sort:m.qh.FREQ}}),R=(e,t,s,o={})=>({pathname:"/organizations/".concat(e,"/issues/"),query:{...o,project:t,query:new p.an(["release:".concat(s),"error.unhandled:true"]).formatString(),sort:m.qh.FREQ}}),B=(e,t,s,o={})=>({pathname:"/organizations/".concat(e,"/issues/"),query:{...o,project:t,query:new p.an(["release:".concat(s),"error.handled:true"]).formatString(),sort:m.qh.FREQ}}),_=e=>e.status===h.dE.Archived;function I(e,t){return e===v.zY.USERS?(0,c.tn)("user","users",t):(0,c.tn)("session","sessions",t)}function x(e){var t;const{lastEvent:s,currentProjectMeta:o,dateCreated:a}=e||{},{sessionsUpperBound:n}=o||{},r=l()(a).startOf("minute").utc().format(),i=l()(null!==(t=l()(n).isAfter(s)?n:s)&&void 0!==t?t:void 0).startOf("minute").utc().format();return l()(r).isSame(i,"minute")?{releaseStart:r,releaseEnd:l()(i).add(1,"minutes").utc().format()}:{releaseStart:r,releaseEnd:i}}function w({location:e,releaseBounds:t,defaultStatsPeriod:s,allowEmptyPeriod:o}){const n=(0,u.Q)(a()(e.query,[...Object.values(d.nF),...Object.values(d.V),"cursor"]),{allowAbsolutePageDatetime:!0,defaultStatsPeriod:s,allowEmptyPeriod:o});return Object.keys(n).some((e=>[d.nF.START,d.nF.END,d.nF.UTC,d.nF.PERIOD].includes(e)))||(n[d.nF.START]=t.releaseStart,n[d.nF.END]=t.releaseEnd),n}},"./app/views/releases/utils/releaseHealthRequest.tsx":(e,t,s)=>{s.d(t,{Yr:()=>I,pE:()=>x,ZP:()=>E});var o=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.array.reduce.js"),s("../node_modules/react/index.js")),n=s("../node_modules/lodash/isEqual.js"),r=s.n(n),i=s("../node_modules/lodash/omit.js"),l=s.n(i),u=s("../node_modules/lodash/pick.js"),d=s.n(u),c=s("../node_modules/moment/moment.js"),h=s.n(c),p=s("./app/actionCreators/indicator.tsx"),m=s("./app/components/charts/utils.tsx"),v=s("./app/components/organizations/globalSelectionHeader/getParams.tsx"),y=s("./app/constants/globalSelectionHeader.tsx"),S=s("./app/locale.tsx"),g=s("./app/types/index.tsx"),f=s("./app/utils.tsx"),P=s("./app/utils/tokenizeSearch.tsx"),C=s("./app/utils/withApi.tsx"),j=s("./app/views/releases/list/utils.tsx"),R=s("./app/views/releases/utils/index.tsx");function B(e){return l()(e,["api","organization","children","selection.datetime.utc","location"])}function _(e){const t=(0,m.Nm)(e);return t>=m.$i?"1d":t>=m.IZ?"6h":t>m.w3?"4h":"1h"}function I(e,t,s){var o;return null===(o=t.series[s])||void 0===o||o.forEach(((t,s)=>{var o;return e[s]=(null!==(o=e[s])&&void 0!==o?o:0)+t})),e}function x(e){switch(e){case j.zY.USERS:return"count_unique(user)";case j.zY.SESSIONS:default:return"sum(session)"}}class w extends a.Component{constructor(...e){super(...e),(0,o.Z)(this,"state",{loading:!1,errored:!1,statusCountByReleaseInPeriod:null,totalCountByReleaseIn24h:null,totalCountByProjectIn24h:null,statusCountByProjectInPeriod:null}),(0,o.Z)(this,"fetchData",(async()=>{const{api:e,healthStatsPeriod:t,disable:s}=this.props;if(s)return;e.clear(),this.setState({loading:!0,errored:!1,statusCountByReleaseInPeriod:null,totalCountByReleaseIn24h:null,totalCountByProjectIn24h:null});const o=[this.fetchStatusCountByReleaseInPeriod(),this.fetchTotalCountByReleaseIn24h(),this.fetchTotalCountByProjectIn24h()];t===g.$A.AUTO&&o.push(this.fetchStatusCountByProjectInPeriod());try{const[e,t,s,a]=await Promise.all(o);this.setState({loading:!1,statusCountByReleaseInPeriod:e,totalCountByReleaseIn24h:t,totalCountByProjectIn24h:s,statusCountByProjectInPeriod:a})}catch(e){var a,n;(0,p.Iw)(null!==(a=null===(n=e.responseJSON)||void 0===n?void 0:n.detail)&&void 0!==a?a:(0,S.t)("Error loading health data")),this.setState({loading:!1,errored:!0})}})),(0,o.Z)(this,"getHealthData",(()=>({getCrashCount:this.getCrashCount,getCrashFreeRate:this.getCrashFreeRate,get24hCountByRelease:this.get24hCountByRelease,get24hCountByProject:this.get24hCountByProject,getTimeSeries:this.getTimeSeries,getAdoption:this.getAdoption}))),(0,o.Z)(this,"getCrashCount",((e,t,s)=>{var o;const{statusCountByReleaseInPeriod:a}=this.state,n=x(s);return null==a||null===(o=a.groups.find((({by:s})=>s.release===e&&s.project===t&&"crashed"===s["session.status"])))||void 0===o?void 0:o.totals[n]})),(0,o.Z)(this,"getCrashFreeRate",((e,t,s)=>{var o;const{statusCountByReleaseInPeriod:a}=this.state,n=x(s),r=null==a||null===(o=a.groups.filter((({by:s})=>s.release===e&&s.project===t)))||void 0===o?void 0:o.reduce(((e,t)=>e+t.totals[n]),0),i=this.getCrashCount(e,t,s);return(0,f.ri)(r)&&0!==r?(0,R.Mf)(100-(0,f.aQ)(null!=i?i:0,null!=r?r:0)):null})),(0,o.Z)(this,"get24hCountByRelease",((e,t,s)=>{var o;const{totalCountByReleaseIn24h:a}=this.state,n=x(s);return null==a||null===(o=a.groups.filter((({by:s})=>s.release===e&&s.project===t)))||void 0===o?void 0:o.reduce(((e,t)=>e+t.totals[n]),0)})),(0,o.Z)(this,"get24hCountByProject",((e,t)=>{var s;const{totalCountByProjectIn24h:o}=this.state,a=x(t);return null==o||null===(s=o.groups.filter((({by:t})=>t.project===e)))||void 0===s?void 0:s.reduce(((e,t)=>e+t.totals[a]),0)})),(0,o.Z)(this,"getTimeSeries",((e,t,s)=>{const{healthStatsPeriod:o}=this.props;return o===g.$A.AUTO?this.getPeriodTimeSeries(e,t,s):this.get24hTimeSeries(e,t,s)})),(0,o.Z)(this,"get24hTimeSeries",((e,t,s)=>{var o,a,n;const{totalCountByReleaseIn24h:r,totalCountByProjectIn24h:i}=this.state,l=x(s),u=null!==(o=null==i?void 0:i.intervals)&&void 0!==o?o:[],d=null==i||null===(a=i.groups.find((({by:e})=>e.project===t)))||void 0===a?void 0:a.series[l],c=null==r||null===(n=r.groups.find((({by:s})=>s.project===t&&s.release===e)))||void 0===n?void 0:n.series[l];return[{seriesName:(0,S.t)("This Release"),data:null==u?void 0:u.map(((e,t)=>{var s;return{name:h()(e).valueOf(),value:null!==(s=null==c?void 0:c[t])&&void 0!==s?s:0}}))},{seriesName:(0,S.t)("Total Project"),data:null==u?void 0:u.map(((e,t)=>{var s;return{name:h()(e).valueOf(),value:null!==(s=null==d?void 0:d[t])&&void 0!==s?s:0}})),z:0}]})),(0,o.Z)(this,"getPeriodTimeSeries",((e,t,s)=>{var o,a,n;const{statusCountByReleaseInPeriod:r,statusCountByProjectInPeriod:i}=this.state,l=x(s),u=null!==(o=null==i?void 0:i.intervals)&&void 0!==o?o:[],d=null==i||null===(a=i.groups.filter((({by:e})=>e.project===t)))||void 0===a?void 0:a.reduce(((e,t)=>I(e,t,l)),[]),c=null==r||null===(n=r.groups.filter((({by:s})=>s.project===t&&s.release===e)))||void 0===n?void 0:n.reduce(((e,t)=>I(e,t,l)),[]);return[{seriesName:(0,S.t)("This Release"),data:null==u?void 0:u.map(((e,t)=>{var s;return{name:h()(e).valueOf(),value:null!==(s=null==c?void 0:c[t])&&void 0!==s?s:0}}))},{seriesName:(0,S.t)("Total Project"),data:null==u?void 0:u.map(((e,t)=>{var s;return{name:h()(e).valueOf(),value:null!==(s=null==d?void 0:d[t])&&void 0!==s?s:0}})),z:0}]})),(0,o.Z)(this,"getAdoption",((e,t,s)=>{const o=this.get24hCountByRelease(e,t,s),a=this.get24hCountByProject(t,s);return(0,f.ri)(o)&&(0,f.ri)(a)?(0,f.aQ)(o,a):void 0}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){this.props.releasesReloading||r()(B(e),B(this.props))||this.fetchData()}get path(){const{organization:e}=this.props;return"/organizations/".concat(e.slug,"/sessions/")}get baseQueryParams(){const{location:e,selection:t,defaultStatsPeriod:s,releases:o}=this.props;return{query:new P.an(o.reduce(((e,t,s,o)=>(e.push('release:"'.concat(t,'"')),s<o.length-1&&e.push("OR"),e)),[])).formatString(),interval:_(t.datetime),...(0,v.Q)(d()(e.query,Object.values(y.nF)),{defaultStatsPeriod:s})}}async fetchStatusCountByReleaseInPeriod(){const{api:e,display:t}=this.props;return await e.requestPromise(this.path,{query:{...this.baseQueryParams,field:[...new Set([...t.map((e=>x(e))),"sum(session)"])],groupBy:["project","release","session.status"]}})}async fetchStatusCountByProjectInPeriod(){const{api:e,display:t}=this.props;return await e.requestPromise(this.path,{query:{...this.baseQueryParams,query:void 0,field:[...new Set([...t.map((e=>x(e))),"sum(session)"])],groupBy:["project","session.status"]}})}async fetchTotalCountByReleaseIn24h(){const{api:e,display:t}=this.props;return await e.requestPromise(this.path,{query:{...this.baseQueryParams,field:t.map((e=>x(e))),groupBy:["project","release"],interval:"1h",statsPeriod:"24h"}})}async fetchTotalCountByProjectIn24h(){const{api:e,display:t}=this.props;return await e.requestPromise(this.path,{query:{...this.baseQueryParams,query:void 0,field:t.map((e=>x(e))),groupBy:["project"],interval:"1h",statsPeriod:"24h"}})}render(){const{loading:e,errored:t}=this.state,{children:s}=this.props;return s({isHealthLoading:e,errored:t,getHealthData:this.getHealthData()})}}w.displayName="ReleaseHealthRequest";const E=(0,C.Z)(w)}}]);
//# sourceMappingURL=../sourcemaps/app_utils_routeTitle_tsx-app_views_asyncView_tsx-app_views_releases_utils_releaseHealthRequest_tsx.6191711e645361f9cfa0ddd26b3034f2.js.map