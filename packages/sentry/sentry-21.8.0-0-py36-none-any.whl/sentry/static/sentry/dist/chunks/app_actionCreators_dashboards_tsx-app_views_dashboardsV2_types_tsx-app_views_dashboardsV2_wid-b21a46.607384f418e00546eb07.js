"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_actionCreators_dashboards_tsx-app_views_dashboardsV2_types_tsx-app_views_dashboardsV2_wid-b21a46"],{"./app/actionCreators/dashboards.tsx":(e,t,o)=>{o.d(t,{JR:()=>n,AK:()=>a,Y:()=>i,iM:()=>d,QL:()=>l});var s=o("./app/actionCreators/indicator.tsx"),r=o("./app/locale.tsx");function n(e,t,o,n){const{title:a,widgets:i}=o,d=e.requestPromise("/organizations/".concat(t,"/dashboards/"),{method:"POST",data:{title:a,widgets:i,duplicate:n}});return d.catch((e=>{var t;const o=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;o?(0,s.Iw)(o):(0,s.Iw)((0,r.t)("Unable to create dashboard"))})),d}function a(e,t,o){const n=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(o,"/"),{method:"GET"});return n.catch((e=>{var t;const o=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;o?(0,s.Iw)(o):(0,s.Iw)((0,r.t)("Unable to load dashboard"))})),n}function i(e,t,o){const n={title:o.title,widgets:o.widgets},a=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(o.id,"/"),{method:"PUT",data:n});return a.catch((e=>{var t;const o=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;o?(0,s.Iw)(o):(0,s.Iw)((0,r.t)("Unable to update dashboard"))})),a}function d(e,t,o){const n=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(o,"/"),{method:"DELETE"});return n.catch((e=>{var t;const o=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;o?(0,s.Iw)(o):(0,s.Iw)((0,r.t)("Unable to delete dashboard"))})),n}function l(e,t,o){return e.requestPromise("/organizations/".concat(t,"/dashboards/widgets/"),{method:"POST",data:o})}},"./app/components/charts/areaChart.tsx":(e,t,o)=>{o.d(t,{Z:()=>d});var s=o("../node_modules/react/index.js"),r=o("./app/components/charts/series/lineSeries.tsx"),n=o("./app/components/charts/baseChart.tsx"),a=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends s.Component{render(){const{series:e,stacked:t,colors:o,...s}=this.props;return(0,a.tZ)(n.Z,{...s,colors:o,series:e.map((({seriesName:e,data:s,...n},a)=>function(e={}){return(0,r.Z)({...e})}({stack:t?"area":void 0,name:e,data:s.map((({name:e,value:t})=>[e,t])),lineStyle:{color:null==o?void 0:o[a],opacity:1,width:.4},areaStyle:{color:null==o?void 0:o[a],opacity:1},animation:!1,animationThreshold:1,animationDuration:0,...n})))})}}i.displayName="AreaChart";const d=i},"./app/components/charts/chartZoom.tsx":(e,t,o)=>{o.d(t,{Z:()=>g});var s=o("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=o("../node_modules/react/index.js"),n=o("../node_modules/moment/moment.js"),a=o.n(n),i=o("../node_modules/query-string/index.js"),d=o("./app/actionCreators/globalSelection.tsx"),l=o("./app/components/charts/components/dataZoomInside.tsx"),p=o("./app/components/charts/components/toolBox.tsx"),c=o("./app/utils/callIfFunction.tsx"),u=o("./app/utils/dates.tsx");const h=e=>e?a().utc(e).format(a().HTML5_FMT.DATETIME_LOCAL_SECONDS):null;class m extends r.Component{constructor(e){super(e),(0,s.Z)(this,"history",void 0),(0,s.Z)(this,"currentPeriod",void 0),(0,s.Z)(this,"zooming",null),(0,s.Z)(this,"saveCurrentPeriod",(e=>{this.currentPeriod={period:e.period,start:h(e.start),end:h(e.end)}})),(0,s.Z)(this,"setPeriod",(({period:e,start:t,end:o},s=!1)=>{const{router:r,onZoom:n,usePageDate:a}=this.props,l=h(t),p=h(o);s&&this.history.push(this.currentPeriod),(0,c.g)(n,{period:e,start:l,end:p}),this.zooming=()=>{if(a&&r){const s={...r.location.query,pageStart:t?(0,u.v5)(t):void 0,pageEnd:o?(0,u.v5)(o):void 0,pageStatsPeriod:null!=e?e:void 0};i.stringify(s)!==i.stringify(r.location.query)&&r.push({pathname:r.location.pathname,query:s})}else(0,d.dR)({period:e,start:l?(0,u.hC)(l):l,end:p?(0,u.hC)(p):p},r);this.saveCurrentPeriod({period:e,start:t,end:o})}})),(0,s.Z)(this,"handleChartReady",(e=>{e.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:!0}),(0,c.g)(this.props.onChartReady,e)})),(0,s.Z)(this,"handleZoomRestore",((e,t)=>{this.history.length&&(this.setPeriod(this.history[0]),this.history=[],(0,c.g)(this.props.onRestore,e,t))})),(0,s.Z)(this,"handleDataZoom",((e,t)=>{const o=t.getModel(),{xAxis:s}=o.option,r=s[0];if(null===r.rangeStart&&null===r.rangeEnd){const e=this.history.pop();if(!e)return;this.setPeriod(e)}else{const e=a().utc(r.rangeStart),t=a().utc(r.rangeEnd);this.setPeriod({period:null,start:e,end:t},!0)}(0,c.g)(this.props.onDataZoom,e,t)})),(0,s.Z)(this,"handleChartFinished",(()=>{"function"==typeof this.zooming&&(this.zooming(),this.zooming=null),(0,c.g)(this.props.onFinished)})),this.history=[],this.saveCurrentPeriod(e)}componentDidUpdate(){this.props.disabled||this.saveCurrentPeriod(this.props)}render(){const{utc:e,start:t,end:o,disabled:s,children:r,xAxisIndex:n,router:a,onZoom:i,onRestore:d,onChartReady:c,onDataZoom:h,onFinished:m,...g}=this.props,v=null!=e?e:void 0,b=t?(0,u.hC)(t):void 0,y=o?(0,u.hC)(o):void 0;return r(s?{utc:v,start:b,end:y,...g}:{isGroupedByDate:!0,onChartReady:this.handleChartReady,utc:v,start:b,end:y,dataZoom:(0,l.Z)({xAxisIndex:n}),showTimeInTooltip:!0,toolBox:(0,p.Z)({},{dataZoom:{title:{zoom:"",back:""},iconStyle:{borderWidth:0,color:"transparent",opacity:0}}}),onDataZoom:this.handleDataZoom,onFinished:this.handleChartFinished,onRestore:this.handleZoomRestore,...g})}}m.displayName="ChartZoom";const g=m},"./app/components/charts/components/visualMap.tsx":(e,t,o)=>{function s(e){return e}o.d(t,{Z:()=>s}),o("../node_modules/echarts/lib/component/visualMap.js")},"./app/components/charts/transitionChart.tsx":(e,t,o)=>{o.d(t,{Z:()=>d});var s=o("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(o("../node_modules/core-js/modules/web.dom-collections.iterator.js"),o("../node_modules/react/index.js")),n=o("./app/components/charts/loadingPanel.tsx"),a=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends r.Component{constructor(...e){super(...e),(0,s.Z)(this,"state",{prevReloading:this.props.reloading,prevLoading:this.props.loading,key:1})}static getDerivedStateFromProps(e,t){const o=t.prevReloading,s=e.reloading,r=t.prevLoading,n=e.loading;return r!==n?{prevReloading:s,prevLoading:n,key:t.key+1}:n?{prevReloading:s,prevLoading:n,key:t.key}:o&&!s?{prevReloading:s,prevLoading:n,key:t.key+1}:{prevReloading:s,prevLoading:n,key:t.key}}render(){const{height:e,loading:t,reloading:o}=this.props;return t&&!o?(0,a.tZ)(n.Z,{height:e,"data-test-id":"events-request-loading"}):(0,a.tZ)(r.Fragment,{children:this.props.children},String(this.state.key))}}i.displayName="TransitionChart",(0,s.Z)(i,"defaultProps",{height:"200px"});const d=i},"./app/components/charts/transparentLoadingMask.tsx":(e,t,o)=>{o.d(t,{Z:()=>a});var s=o("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(o("../node_modules/react/index.js"),o("./app/components/loadingMask.tsx")),n=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const a=(0,s.Z)((({className:e,visible:t,children:o,...s})=>{const a=t?{...s,"data-test-id":"loading-placeholder"}:s;return(0,n.tZ)(r.Z,{className:e,...a,children:o})}),{target:"ewtkxp50"})((e=>!e.visible&&"display: none;"),";opacity:0.4;z-index:1;")},"./app/views/dashboardsV2/contextMenu.tsx":(e,t,o)=>{o.d(t,{Z:()=>u});var s=o("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=o("../node_modules/classnames/index.js"),n=o.n(r),a=o("./app/components/dropdownMenu.tsx"),i=o("./app/icons/index.tsx"),d=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const l=({children:e})=>(0,d.tZ)(a.Z,{children:({isOpen:t,getRootProps:o,getActorProps:s,getMenuProps:r})=>{const a=n()("dropdown",{"anchor-right":!0,open:t});return(0,d.BX)(p,{...o({className:a}),children:[(0,d.tZ)(c,{...s({onClick:e=>{e.stopPropagation(),e.preventDefault()}}),children:(0,d.tZ)(i.YR,{"data-test-id":"context-menu",size:"md"})}),t&&(0,d.tZ)("ul",{...r({}),className:n()("dropdown-menu"),children:e})]})}});l.displayName="ContextMenu";const p=(0,s.Z)("span",{target:"e1xn1f5x1"})("display:flex;color:",(e=>e.theme.textColor),";"),c=(0,s.Z)("div",{target:"e1xn1f5x0"})({name:"1y7emqs",styles:"display:flex;cursor:pointer;padding:0 5px"}),u=l},"./app/views/dashboardsV2/types.tsx":(e,t,o)=>{let s,r;o.d(t,{F:()=>s,n:()=>r}),function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.TABLE="table",e.WORLD_MAP="world_map",e.BIG_NUMBER="big_number",e.STACKED_AREA="stacked_area"}(s||(s={})),function(e){e.VIEW="view",e.EDIT="edit",e.CREATE="create",e.PENDING_DELETE="pending_delete"}(r||(r={}))},"./app/views/dashboardsV2/utils.tsx":(e,t,o)=>{o.d(t,{q:()=>i,t:()=>d});var s=o("../node_modules/lodash/cloneDeep.js"),r=o.n(s),n=o("./app/utils/dates.tsx"),a=o("./app/utils/discover/eventView.tsx");function i(e){return r()(e)}function d(e,t,o){const{start:s,end:r,period:i}=o.datetime,{projects:d,environments:l}=o;return a.ZP.fromSavedQuery({id:void 0,name:e,version:2,fields:t.fields,query:t.conditions,orderby:t.orderby,projects:d,range:i,start:s?(0,n.v5)(s):void 0,end:r?(0,n.v5)(r):void 0,environment:l})}},"./app/views/dashboardsV2/widgetCard.tsx":(e,t,o)=>{o.d(t,{Z:()=>ve});var s=o("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=o("../node_modules/react/index.js"),n=o("../node_modules/react-router/es/index.js"),a=o("../node_modules/lodash/isEqual.js"),i=o.n(a),d=o("./app/components/charts/styles.tsx"),l=o("./app/components/errorBoundary.tsx"),p=o("./app/components/menuItem.tsx"),c=o("./app/components/organizations/globalSelectionHeader/utils.tsx"),u=o("./app/components/panels/index.tsx"),h=o("./app/components/placeholder.tsx"),m=o("./app/icons/index.tsx"),g=o("./app/locale.tsx"),v=o("./app/styles/overflowEllipsis.tsx"),b=o("./app/styles/space.tsx"),y=o("./app/utils/analytics.tsx"),Z=o("./app/utils/withApi.tsx"),x=o("./app/utils/withGlobalSelection.tsx"),f=o("./app/utils/withOrganization.tsx"),w=o("./app/views/dashboardsV2/contextMenu.tsx"),C=o("./app/views/dashboardsV2/utils.tsx"),_=o("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),R=o("./app/components/charts/areaChart.tsx"),j=o("./app/components/charts/barChart.tsx"),S=o("./app/components/charts/chartZoom.tsx"),T=o("./app/components/charts/errorPanel.tsx"),M=o("./app/components/charts/lineChart.tsx"),k=o("./app/components/panels/panelTable.tsx"),D=o("./app/utils/discover/fieldRenderers.tsx"),q=o("./app/utils/discover/fields.tsx"),z=o("./app/views/eventsV2/utils.tsx"),P=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class E extends r.Component{renderRow(e,t,o,s){const{location:r,organization:n}=this.props;return s.map((s=>{const a=(0,D.Js)(s.name,o)(t,{organization:n,location:r});return(0,P.tZ)(A,{children:a},"".concat(e,":").concat(s.name))}))}render(){const{className:e,loading:t,fields:o,metadata:s,data:n,title:a}=this.props,i=null!=s?s:{},d=(0,z.Hg)(o.map((e=>({field:e}))));return(0,P.BX)(r.Fragment,{children:[a&&(0,P.tZ)("h4",{children:a}),(0,P.tZ)(N,{className:e,isLoading:t,headers:d.map(((e,t)=>{const o=(0,q.qG)(e.name,e.type,i);return(0,P.tZ)(I,{align:o,children:e.name},t)})),isEmpty:!(null!=n&&n.length),disablePadding:!0,children:null==n?void 0:n.map(((e,t)=>this.renderRow(t,e,i,d)))})]})}}E.displayName="SimpleTableChart";const N=(0,s.Z)(k.Z,{target:"e3tr8vk2"})("border-radius:0;border-left:0;border-right:0;border-bottom:0;margin:0;",k.z,"{height:min-content;}"),I=(0,s.Z)("div",{target:"e3tr8vk1"})((e=>e.align?"text-align: ".concat(e.align,";"):"")," padding:",(0,b.Z)(1)," ",(0,b.Z)(3),";"),A=(0,s.Z)("div",{target:"e3tr8vk0"})("padding:",(0,b.Z)(1)," ",(0,b.Z)(3),";"),F=(0,f.Z)(E);var L=o("./app/components/charts/transitionChart.tsx"),O=o("./app/components/charts/transparentLoadingMask.tsx"),B=o("./app/components/charts/utils.tsx"),W=o("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),U=(o("../node_modules/core-js/modules/web.dom-collections.iterator.js"),o("../node_modules/core-js/modules/es.object.from-entries.js"),o("../node_modules/echarts/index.js")),V=o.n(U),X=o("../node_modules/lodash/max.js"),J=o.n(X),G=o("./app/components/charts/components/visualMap.tsx");o("../node_modules/echarts/lib/chart/map.js");var H=o("./app/components/charts/baseChart.tsx");class Q extends r.Component{constructor(...e){super(...e),(0,W.Z)(this,"state",{countryToCodeMap:null,map:null,codeToCountryMap:null})}async componentDidMount(){const[e,t]=await Promise.all([o.e("app_data_countryCodesMap_tsx").then(o.bind(o,"./app/data/countryCodesMap.tsx")),o.e("app_data_world_json").then(o.t.bind(o,"./app/data/world.json",19))]);V().registerMap("sentryWorld",t.default),this.setState({countryToCodeMap:e.default,map:t.default,codeToCountryMap:Object.fromEntries(Object.entries(e.default).map((([e,t])=>[t,e])))})}render(){const{countryToCodeMap:e,map:t}=this.state;if(null===e||null===t)return null;const{series:o,seriesOptions:s,theme:r,...n}=this.props,a=o.map((({seriesName:e,data:t,...o})=>{var n;return function(e={}){return{roam:!0,itemStyle:{emphasis:{label:{show:!1}}},...e,type:"map"}}({...s,...o,map:"sentryWorld",name:e,nameMap:null!==(n=this.state.countryToCodeMap)&&void 0!==n?n:void 0,aspectScale:.85,zoom:1.3,center:[10.97,9.71],itemStyle:{areaColor:r.gray200,borderColor:r.backgroundSecondary,emphasis:{areaColor:r.orange300}},label:{emphasis:{show:!1}},data:t})})),i=J()(o.map((({data:e})=>J()(e.map((({value:e})=>e))))))||1;return(0,P.tZ)(H.Z,{options:{backgroundColor:r.background,visualMap:[(0,G.Z)({left:"right",min:0,max:i,inRange:{color:[r.purple200,r.purple300]},text:["High","Low"],textStyle:{color:r.textColor},calculable:!1})]},...n,yAxis:null,xAxis:null,series:a,tooltip:{formatter:e=>{var t;const{marker:o,name:s,value:r}=Array.isArray(e)?e[0]:e;if(isNaN(r))return"";const n="number"==typeof r?r.toLocaleString():"",a=(null===(t=this.state.codeToCountryMap)||void 0===t?void 0:t[s])||s;return['<div class="tooltip-series tooltip-series-solo">\n                 <div><span class="tooltip-label">'.concat(o," <strong>").concat(a,"</strong></span> ").concat(n,"</div>\n              </div>"),'<div class="tooltip-arrow"></div>'].join("")}}})}}Q.displayName="WorldMapChart";const K=(0,_.b)(Q);var Y=o("./app/components/loadingIndicator.tsx"),$=o("./app/utils/discover/charts.tsx"),ee=o("./app/utils/getDynamicText.tsx");class te extends r.Component{shouldComponentUpdate(e){const t={...this.props,widget:{...this.props.widget,title:""}};return e={...e,widget:{...e.widget,title:""}},!i()(t,e)}tableResultComponent({loading:e,errorMessage:t,tableResults:o}){const{location:s,widget:r,organization:n}=this.props;return t?(0,P.tZ)(T.Z,{children:(0,P.tZ)(m.FC,{color:"gray500",size:"lg"})}):void 0===o||e?(0,P.tZ)(h.Z,{height:"200px"}):o.map(((t,a)=>{var i,d;const l=null!==(i=null===(d=r.queries[a])||void 0===d?void 0:d.fields)&&void 0!==i?i:[];return(0,P.tZ)(ae,{location:s,fields:l,title:o.length>1?t.title:"",loading:e,metadata:t.meta,data:t.data,organization:n},"table:".concat(t.title))}))}bigNumberComponent({loading:e,errorMessage:t,tableResults:o}){return t?(0,P.tZ)(T.Z,{children:(0,P.tZ)(m.FC,{color:"gray500",size:"lg"})}):void 0===o||e?(0,P.tZ)(re,{children:"—"}):o.map((e=>{var t;const o=null!==(t=e.meta)&&void 0!==t?t:{},s=Object.keys(null!=o?o:{})[0];if(!s||!e.data.length)return(0,P.tZ)(re,{children:"—"},"big_number:".concat(e.title));const r=e.data[0],n=(0,D.fK)(s,o)(r);return(0,P.tZ)(re,{children:n},"big_number:".concat(e.title))}))}chartComponent(e){const{widget:t}=this.props;switch(t.displayType){case"bar":return(0,P.tZ)(j.Z,{...e});case"area":return(0,P.tZ)(R.Z,{stacked:!0,...e});case"world_map":return(0,P.tZ)(K,{...e});case"line":default:return(0,P.tZ)(M.Z,{...e})}}render(){var e,t,o;const{theme:s,tableResults:r,timeseriesResults:n,errorMessage:a,loading:i,widget:d}=this.props;if("table"===d.displayType)return(0,P.BX)(L.Z,{loading:i,reloading:i,children:[(0,P.tZ)(se,{loading:i}),this.tableResultComponent({tableResults:r,loading:i,errorMessage:a})]});if("big_number"===d.displayType)return(0,P.BX)(L.Z,{loading:i,reloading:i,children:[(0,P.tZ)(se,{loading:i}),this.bigNumberComponent({tableResults:r,loading:i,errorMessage:a})]});if(a)return(0,P.tZ)(T.Z,{children:(0,P.tZ)(m.FC,{color:"gray500",size:"lg"})});const{location:l,router:p,selection:c}=this.props,{start:u,end:g,period:v,utc:b}=c.datetime;if("world_map"===d.displayType){const e={title:"",data:[]},t=()=>{var t;if(!r||!r.length)return e;const o=r[0],{data:s,meta:n}=o;if(!s||!s.length||!n)return e;const a=Object.keys(n).find((e=>"geo.country_code"!==e));return a?{title:null!==(t=o.title)&&void 0!==t?t:"",data:s.filter((e=>e["geo.country_code"])).map((e=>({name:e["geo.country_code"],value:e[a]})))}:e},{data:o,title:s}=t(),n=[{seriesName:s,data:o}];return(0,P.BX)(L.Z,{loading:i,reloading:i,children:[(0,P.tZ)(se,{loading:i}),(0,P.tZ)(ne,{children:(0,ee.Z)({value:this.chartComponent({series:n}),fixed:(0,P.tZ)(h.Z,{height:"200px",testId:"skeleton-ui"})})})]})}const y={left:0,top:0,selected:(0,B.RI)(l),formatter:e=>{const t=(0,q.hW)(e);if(null!==t){const o=(0,q.b8)(t);null!==o&&(e=o.toUpperCase())}return e}},Z=null!==(e=null===(t=d.queries[0])||void 0===t||null===(o=t.fields)||void 0===o?void 0:o[0])&&void 0!==e?e:"count()",x={grid:{left:0,right:0,top:"40px",bottom:0},seriesOptions:{showSymbol:!1},tooltip:{trigger:"axis",valueFormatter:$.CX},yAxis:{axisLabel:{color:s.chartLabel,formatter:e=>(0,$.gu)(e,Z)}}};return(0,P.tZ)(S.Z,{router:p,period:v,start:u,end:g,utc:b,children:e=>{if(a)return(0,P.tZ)(T.Z,{children:(0,P.tZ)(m.FC,{color:"gray500",size:"lg"})});const t=n?s.charts.getColorPalette(n.length-2):[],o=n?n.map(((e,o)=>({...e,color:t[o]}))):[];return(0,P.BX)(L.Z,{loading:i,reloading:i,children:[(0,P.tZ)(se,{loading:i}),(0,P.tZ)(ne,{children:(0,ee.Z)({value:this.chartComponent({...e,...x,legend:y,series:o}),fixed:(0,P.tZ)(h.Z,{height:"200px",testId:"skeleton-ui"})})})]})}})}}te.displayName="WidgetCardChart";const oe=(0,s.Z)((e=>(0,P.tZ)(O.Z,{...e,maskBackgroundColor:"transparent"})),{target:"e1od7x483"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"}),se=({loading:e})=>e?(0,P.tZ)(oe,{visible:e,children:(0,P.tZ)(Y.Z,{mini:!0})}):null;se.displayName="LoadingScreen";const re=(0,s.Z)("div",{target:"e1od7x482"})("font-size:32px;padding:",(0,b.Z)(1)," ",(0,b.Z)(3)," ",(0,b.Z)(3)," ",(0,b.Z)(3),";*{text-align:left!important;}"),ne=(0,s.Z)("div",{target:"e1od7x481"})("padding:0 ",(0,b.Z)(3)," ",(0,b.Z)(3),";"),ae=(0,s.Z)(F,{target:"e1od7x480"})("margin-top:",(0,b.Z)(1.5),";border-bottom-left-radius:",(e=>e.theme.borderRadius),";border-bottom-right-radius:",(e=>e.theme.borderRadius),";font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:none;"),ie=(0,_.b)(te);o("../node_modules/core-js/modules/es.array.reduce.js"),o("../node_modules/core-js/modules/es.symbol.description.js");var de=o("./app/actionCreators/events.tsx"),le=o("./app/utils/dates.tsx"),pe=o("./app/utils/discover/genericDiscoverQuery.tsx");function ce(e,t){return{seriesName:t,data:e.data.map((([e,t])=>({name:1e3*e,value:t.reduce(((e,{count:t})=>e+t),0)})))}}function ue(e,t){let o=[];const s=e.name;if((0,B.Xe)(t)){const e=Object.keys(t).map((e=>{const o=s?"".concat(s," : ").concat(e):e,r=t[e];return[r.order||0,ce(r,o)]})).sort(((e,t)=>e[0]-t[0])).map((e=>e[1]));o=o.concat(e)}else{const r=e.fields[0],n=s?"".concat(s," : ").concat(r):r,a=ce(t,n);o.push(a)}return o}class he extends r.Component{constructor(...e){super(...e),(0,W.Z)(this,"state",{loading:!0,queryFetchID:void 0,errorMessage:void 0,timeseriesResults:void 0,rawResults:void 0,tableResults:void 0})}componentDidMount(){this.fetchData()}componentDidUpdate(e){var t;const{selection:o,widget:s}=this.props,[r,n]=e.widget.queries.reduce((([e,t],{name:o,...s})=>(e.push(o),t.push(s),[e,t])),[[],[]]),[a,d]=s.queries.reduce((([e,t],{name:o,...s})=>(e.push(o),t.push(s),[e,t])),[[],[]]);i()(s.displayType,e.widget.displayType)&&i()(s.interval,e.widget.interval)&&i()(d,n)&&i()(s.displayType,e.widget.displayType)&&(0,c.WO)(o,e.selection)?this.state.loading||i()(r,a)||(null===(t=this.state.rawResults)||void 0===t?void 0:t.length)!==s.queries.length||this.setState((e=>{const t=s.queries.reduce(((t,o,s)=>t.concat(ue(o,e.rawResults[s]))),[]);return{...e,timeseriesResults:t}})):this.fetchData()}fetchEventData(e){const{selection:t,api:o,organization:s,widget:r}=this.props;let n=[];this.setState({tableResults:[]});const a=r.queries.map((e=>{const n=(0,C.t)(r.title,e,t);let a="";const i={per_page:5,noPagination:!0};if("table"===r.displayType)a="/organizations/".concat(s.slug,"/eventsv2/"),i.referrer="api.dashboards.tablewidget";else if("big_number"===r.displayType)a="/organizations/".concat(s.slug,"/eventsv2/"),i.per_page=1,i.referrer="api.dashboards.bignumberwidget";else{if("world_map"!==r.displayType)throw Error("Expected widget displayType to be either big_number, table or world_map");a="/organizations/".concat(s.slug,"/events-geo/"),delete i.per_page,i.referrer="api.dashboards.worldmapwidget"}return(0,pe.A)(o,a,{...n.generateQueryStringObject(),...i})}));let i=0;a.forEach((async(t,o)=>{try{var s,d;const[l]=await t,p=l;p.title=null!==(s=null===(d=r.queries[o])||void 0===d?void 0:d.name)&&void 0!==s?s:"",n=[...n,p],this.setState((t=>t.queryFetchID!==e?t:{...t,tableResults:n}))}catch(e){var l;const t=(null==e||null===(l=e.responseJSON)||void 0===l?void 0:l.detail)||(0,g.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{i++,this.setState((t=>t.queryFetchID!==e?t:{...t,loading:i!==a.length}))}}))}fetchTimeseriesData(e){const{selection:t,api:o,organization:s,widget:r}=this.props;this.setState({timeseriesResults:[],rawResults:[]});const{environments:n,projects:a}=t,{start:i,end:d,period:l}=t.datetime,p=function(e,t){let o="bar"===e.displayType?"1d":e.interval;o||(o="5m");const s=(0,le.YJ)(o);return(0,B.Nm)(t)/s>4e3?(0,B.ZS)(t,"high"):o}(r,{start:i,end:d,period:l}),c=r.queries.map((e=>{const t={organization:s,interval:p,start:i,end:d,project:a,environment:n,period:l,query:e.conditions,yAxis:e.fields,orderby:e.orderby,includePrevious:!1,referrer:"api.dashboards.timeserieswidget",partial:!0};return(0,de.lI)(o,t)}));let u=0;c.forEach((async(t,o)=>{try{const s=await t;this.setState((t=>{var n,a;if(t.queryFetchID!==e)return t;const i=(null!==(n=t.timeseriesResults)&&void 0!==n?n:[]).concat(ue(r.queries[o],s));return{...t,timeseriesResults:i,rawResults:(null!==(a=t.rawResults)&&void 0!==a?a:[]).concat(s)}}))}catch(e){var s;const t=(null==e||null===(s=e.responseJSON)||void 0===s?void 0:s.detail)||(0,g.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{u++,this.setState((t=>t.queryFetchID!==e?t:{...t,loading:u!==c.length}))}}))}fetchData(){const{widget:e}=this.props,t=Symbol("queryFetchID");this.setState({loading:!0,errorMessage:void 0,queryFetchID:t}),["table","world_map","big_number"].includes(e.displayType)?this.fetchEventData(t):this.fetchTimeseriesData(t)}render(){const{children:e}=this.props,{loading:t,timeseriesResults:o,tableResults:s,errorMessage:r}=this.state;return e({loading:t,timeseriesResults:o,tableResults:s,errorMessage:r})}}he.displayName="WidgetQueries";const me=he;class ge extends r.Component{shouldComponentUpdate(e){return!i()(e.widget,this.props.widget)||!(0,c.WO)(e.selection,this.props.selection)||this.props.isEditing!==e.isEditing||this.props.isSorting!==e.isSorting||this.props.hideToolbar!==e.hideToolbar}renderToolbar(){const{onEdit:e,onDelete:t,draggableProps:o,hideToolbar:s,isEditing:r}=this.props;return r?(0,P.tZ)(Ze,{children:(0,P.BX)(xe,{style:{visibility:s?"hidden":"visible"},children:[(0,P.tZ)(fe,{children:(0,P.tZ)(we,{color:"textColor",...null==o?void 0:o.listeners,...null==o?void 0:o.attributes})}),(0,P.tZ)(fe,{"data-test-id":"widget-edit",onClick:()=>{e()},children:(0,P.tZ)(m.yl,{color:"textColor"})}),(0,P.tZ)(fe,{"data-test-id":"widget-delete",onClick:()=>{t()},children:(0,P.tZ)(m.Fz,{color:"textColor"})})]})}):null}renderContextMenu(){const{widget:e,selection:t,organization:o,showContextMenu:s}=this.props;if(!s)return null;const r=[];if("table"===e.displayType&&o.features.includes("discover-basic")&&e.queries.length){const s=e.queries[0],a=(0,C.t)(e.title,s,t);r.push((0,P.tZ)(p.Z,{onClick:e=>{e.preventDefault(),(0,y.ec)({eventKey:"dashboards2.tablewidget.open_in_discover",eventName:"Dashboards2: Table Widget - Open in Discover",organization_id:parseInt(this.props.organization.id,10)}),n.browserHistory.push(a.getResultsViewUrlTarget(o.slug))},children:(0,g.t)("Open in Discover")},"open-discover"))}return r.length?(0,P.tZ)(Re,{children:(0,P.tZ)(w.Z,{children:r})}):null}render(){const{widget:e,api:t,organization:o,selection:s,renderErrorMessage:n,location:a,router:i}=this.props;return(0,P.tZ)(l.Z,{customComponent:(0,P.tZ)(be,{children:(0,g.t)("Error loading widget data")}),children:(0,P.BX)(ye,{isDragging:!1,children:[(0,P.BX)(_e,{children:[(0,P.tZ)(Ce,{children:e.title}),this.renderContextMenu()]}),(0,P.tZ)(me,{api:t,organization:o,widget:e,selection:s,children:({tableResults:t,timeseriesResults:d,errorMessage:l,loading:p})=>(0,P.BX)(r.Fragment,{children:["function"==typeof n?n(l):null,(0,P.tZ)(ie,{timeseriesResults:d,tableResults:t,errorMessage:l,loading:p,location:a,widget:e,selection:s,router:i,organization:o}),this.renderToolbar()]})})]})})}}ge.displayName="WidgetCard";const ve=(0,Z.Z)((0,f.Z)((0,x.Z)(n.withRouter(ge)))),be=(0,s.Z)(h.Z,{target:"emngp8q8"})("display:flex;align-items:center;justify-content:center;background-color:",(e=>e.theme.alert.error.backgroundLight),";border:1px solid ",(e=>e.theme.alert.error.border),";color:",(e=>e.theme.alert.error.textLight),";border-radius:",(e=>e.theme.borderRadius),";margin-bottom:",(0,b.Z)(2),";"),ye=(0,s.Z)(u.s_,{shouldForwardProp:e=>"isDragging"!==e,target:"emngp8q7"})("margin:0;visibility:",(e=>e.isDragging?"hidden":"visible"),";height:100%;min-height:96px;"),Ze=(0,s.Z)("div",{target:"emngp8q6"})("position:absolute;top:0;left:0;z-index:1;width:100%;height:100%;display:flex;justify-content:flex-end;align-items:flex-start;background-color:",(e=>e.theme.overlayBackgroundAlpha),";border-radius:",(e=>e.theme.borderRadius),";"),xe=(0,s.Z)("div",{target:"emngp8q5"})("display:flex;margin:10px ",(0,b.Z)(2),";touch-action:none;"),fe=(0,s.Z)("div",{target:"emngp8q4"})("padding:",(0,b.Z)(1),";&:hover{cursor:pointer;}"),we=(0,s.Z)(m.LS,{target:"emngp8q3"})({name:"1fhyj3b",styles:"&:hover{cursor:grab;}"}),Ce=(0,s.Z)(d.Gh,{target:"emngp8q2"})(v.Z,";"),_e=(0,s.Z)("div",{target:"emngp8q1"})("padding:",(0,b.Z)(2)," ",(0,b.Z)(3)," 0 ",(0,b.Z)(3),";width:100%;display:flex;justify-content:space-between;"),Re=(0,s.Z)("div",{target:"emngp8q0"})("margin-left:",(0,b.Z)(1),";")}}]);
//# sourceMappingURL=../sourcemaps/app_actionCreators_dashboards_tsx-app_views_dashboardsV2_types_tsx-app_views_dashboardsV2_wid-b21a46.efadca86b453121d2c2b4ae00d682e6c.js.map