"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_settings_account_accountNotificationFineTuning_tsx"],{"./app/views/settings/account/accountNotificationFineTuning.tsx":(t,e,i)=>{i.r(e),i.d(e,{default:()=>M});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(i("../node_modules/core-js/modules/es.symbol.description.js"),i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/react/index.js")),o=i("./app/components/pagination/index.tsx"),a=i("./app/components/panels/index.tsx"),r=i("./app/data/forms/accountNotificationSettings.tsx"),c=i("./app/locale.tsx"),l=i("./app/utils/withOrganizations.tsx"),p=i("./app/views/asyncView.tsx");const d={alerts:{title:"Project Alerts",description:(0,c.t)("Notifications from Alert Rules that your team has setup. Youâ€™ll always receive notifications from Alerts configured to be sent directly to you."),type:"select",choices:[["-1",(0,c.t)("Default")],["1",(0,c.t)("On")],["0",(0,c.t)("Off")]],defaultValue:"-1",defaultFieldName:"subscribeByDefault"},workflow:{title:"Workflow Notifications",description:(0,c.t)("Control workflow notifications, e.g. changes in issue assignment, resolution status, and comments."),type:"select",choices:[["-1",(0,c.t)("Default")],["0",(0,c.t)("Always")],["1",(0,c.t)("Only on issues I subscribe to")],["2",(0,c.t)("Never")]],defaultValue:"-1",defaultFieldName:"workflowNotifications"},deploy:{title:(0,c.t)("Deploy Notifications"),description:(0,c.t)("Control deploy notifications that include release, environment, and commit overviews."),type:"select",choices:[["-1",(0,c.t)("Default")],["2",(0,c.t)("Always")],["3",(0,c.t)("Only on deploys with my commits")],["4",(0,c.t)("Never")]],defaultValue:"-1",defaultFieldName:"deployNotifications"},reports:{title:(0,c.t)("Weekly Reports"),description:(0,c.t)("Reports contain a summary of what's happened within the organization."),type:"select",defaultValue:"1",choices:[["1",(0,c.t)("On")],["0",(0,c.t)("Off")]],defaultFieldName:"weeklyReports"},email:{title:(0,c.t)("Email Routing"),description:(0,c.t)("On a per project basis, route emails to an alternative email address."),type:"select"}};var u=i("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),m=i("./app/components/asyncComponent.tsx"),f=i("./app/views/settings/account/notifications/feedbackAlert.tsx"),h=i("./app/views/settings/account/notifications/fields2.tsx"),g=i("./app/views/settings/account/notifications/utils.tsx"),y=i("./app/views/settings/components/forms/form.tsx"),Z=i("./app/views/settings/components/forms/jsonForm.tsx"),j=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class v extends n.Component{render(){const{notificationType:t,notificationSettings:e,onChange:i,organizations:s}=this.props;return(0,j.tZ)(y.Z,{saveOnBlur:!0,apiMethod:"PUT",apiEndpoint:"/users/me/notification-settings/",initialData:(0,g.tl)(t,e,s),children:(0,j.tZ)(Z.Z,{title:(0,c.t)("Organizations"),fields:s.map((s=>(0,g.gw)(t,e,s,i)))})})}}v.displayName="NotificationSettingsByOrganization";const w=(0,l.Z)(v);i("../node_modules/core-js/modules/es.object.from-entries.js");var x=i("./app/utils.tsx"),b=i("./app/views/settings/account/notifications/constants.tsx"),S=i("./app/views/settings/components/defaultSearchBar.tsx"),P=i("./app/views/settings/components/emptyMessage.tsx");class T extends m.Z{constructor(...t){super(...t),(0,u.Z)(this,"getProjectCount",(()=>{var t;const{notificationType:e,notificationSettings:i}=this.props;return Object.values((null===(t=i[e])||void 0===t?void 0:t.project)||{}).length})),(0,u.Z)(this,"getGroupedProjects",(()=>{const{projects:t}=this.state;return Object.fromEntries(Object.values((0,g.uI)((0,x.Mx)(t))).map((({organization:t,projects:e})=>["".concat(t.name," Projects"),e])))}))}getDefaultState(){return{...super.getDefaultState(),projects:[]}}getEndpoints(){return[["projects","/projects/"]]}renderBody(){const{notificationType:t,notificationSettings:e,onChange:i}=this.props,{projects:s,projectsPageLinks:a}=this.state,r=this.getProjectCount()>=b.Zb,l=s.length>=b.sg;return(0,j.BX)(n.Fragment,{children:[r&&this.renderSearchInput({stateKey:"projects",url:"/projects/",placeholder:(0,c.t)("Search Projects"),children:({defaultSearchBar:t})=>(0,j.tZ)(N,{children:t})}),(0,j.tZ)(y.Z,{saveOnBlur:!0,apiMethod:"PUT",apiEndpoint:"/users/me/notification-settings/",initialData:(0,g.tl)(t,e,s),children:0===s.length?(0,j.tZ)(P.Z,{children:(0,c.t)("No projects found")}):Object.entries(this.getGroupedProjects()).map((([s,n])=>(0,j.tZ)(Z.Z,{title:s,fields:n.map((s=>(0,g.gw)(t,e,s,i)))},s)))}),r&&l&&(0,j.tZ)(o.Z,{pageLinks:a,...this.props})]})}}const B=T,N=(0,s.Z)(S._,{target:"e1ab1zjl0"})({name:"1ekhw56",styles:"*{width:100%;}"});var O=i("./app/views/settings/components/settingsPageHeader.tsx"),D=i("./app/views/settings/components/text/textBlock.tsx");class F extends m.Z{constructor(...t){super(...t),(0,u.Z)(this,"getStateToPutForProvider",(t=>{const{notificationType:e}=this.props,{notificationSettings:i}=this.state,s=(0,g.E2)(e,i,t);return this.setState({notificationSettings:(0,g.r_)(i,s)}),s})),(0,u.Z)(this,"getStateToPutForDefault",(t=>{const{notificationType:e}=this.props,{notificationSettings:i}=this.state,s=(0,g.zD)(e,i,t,(0,g.Vy)(e,i));return this.setState({notificationSettings:(0,g.r_)(i,s)}),s})),(0,u.Z)(this,"getStateToPutForParent",((t,e)=>{const{notificationType:i}=this.props,{notificationSettings:s}=this.state,n=(0,g.O0)(i,s,t,e);return this.setState({notificationSettings:(0,g.r_)(s,n)}),n}))}getDefaultState(){return{...super.getDefaultState(),notificationSettings:{}}}getEndpoints(){const{notificationType:t}=this.props;return[["notificationSettings","/users/me/notification-settings/",{query:{type:t}}]]}getInitialData(){const{notificationType:t}=this.props,{notificationSettings:e}=this.state,i={[t]:(0,g.hx)(t,e)};return(0,g.iy)(t,e)||(i.provider=(0,g.Oi)((0,g.xy)(t,e))),i}getFields(){const{notificationType:t}=this.props,{notificationSettings:e}=this.state,i=[Object.assign({},h.u[t],{help:(0,c.t)("This is the default for all projects."),getData:t=>this.getStateToPutForDefault(t)})];return(0,g.iy)(t,e)||i.push(Object.assign({help:(0,c.t)("Where personal notifications will be sent."),getData:t=>this.getStateToPutForProvider(t)},h.u.provider)),i}renderBody(){const{notificationType:t}=this.props,{notificationSettings:e}=this.state,{title:i,description:s}=d[t];return(0,j.BX)(n.Fragment,{children:[(0,j.tZ)(O.Z,{title:i}),s&&(0,j.tZ)(D.Z,{children:s}),(0,j.tZ)(f.Z,{}),(0,j.tZ)(y.Z,{saveOnBlur:!0,apiMethod:"PUT",apiEndpoint:"/users/me/notification-settings/",initialData:this.getInitialData(),children:(0,j.tZ)(Z.Z,{title:(0,g.yB)(t)?(0,c.t)("All Projects"):(0,c.t)("All Organizations"),fields:this.getFields()})}),!(0,g.iy)(t,e)&&((0,g.yB)(t)?(0,j.tZ)(B,{notificationType:t,notificationSettings:e,onChange:this.getStateToPutForParent}):(0,j.tZ)(w,{notificationType:t,notificationSettings:e,onChange:this.getStateToPutForParent}))]})}}const k=F;var _=i("./app/views/settings/components/forms/selectField.tsx");const z=(0,s.Z)(a.N,{target:"euheq541"})("font-size:1.4rem;&:not(:last-child){border-bottom:1px solid ",(t=>t.theme.innerBorder),";}"),C=({projects:t,field:e})=>{const i=(0,g.uI)(t),{title:s,description:o,...r}=e,c=Object.values(i).map((t=>({name:t.organization.name,projects:t.projects.map((t=>({...r,name:t.id,label:t.slug})))})));return(0,j.tZ)(n.Fragment,{children:c.map((({name:t,projects:e})=>(0,j.BX)("div",{children:[(0,j.tZ)(a.V9,{children:t}),e.map((t=>(0,j.tZ)(z,{children:(0,j.tZ)(_.Z,{defaultValue:t.defaultValue,name:t.name,choices:t.choices,label:t.label})},t.name)))]},t)))})};C.displayName="AccountNotificationsByProject";const V=({organizations:t,field:e})=>{const{title:i,description:s,...o}=e,a=t.map((t=>({...o,name:t.id,label:t.slug})));return(0,j.tZ)(n.Fragment,{children:a.map((t=>(0,j.tZ)(z,{children:(0,j.tZ)(_.Z,{defaultValue:t.defaultValue,name:t.name,choices:t.choices,label:t.label})},t.name)))})};V.displayName="AccountNotificationsByOrganization";const E=(0,l.Z)(V);class A extends p.Z{getEndpoints(){const{fineTuneType:t}=this.props.params,e=[["notifications","/users/me/notifications/"],["fineTuneData","/users/me/notifications/".concat(t,"/")]];return(0,g.yB)(t)&&e.push(["projects","/projects/"]),e.push(["emails","/users/me/emails/"]),"email"===t&&e.push(["emails","/users/me/emails/"]),e}get emailChoices(){var t,e,i;return null!==(t=null===(e=this.state.emails)||void 0===e||null===(i=e.filter((({isVerified:t})=>t)))||void 0===i?void 0:i.sort(((t,e)=>t.isPrimary?-1:e.isPrimary?1:t.email<e.email?-1:1)))&&void 0!==t?t:[]}renderBody(){const{params:t,organizations:e}=this.props,{fineTuneType:i}=t;if(["alerts","deploy","workflow"].includes(i)&&e.some((t=>t.features.includes("notification-platform"))))return(0,j.tZ)(k,{notificationType:i});const{notifications:s,projects:n,fineTuneData:l,projectsPageLinks:p}=this.state,u=(0,g.yB)(i),m=d[i],{title:f,description:h}=m,[v,w]=u?this.getEndpoints()[2]:[],x=!(null==n||!n.length);return"email"===i&&(m.choices=this.emailChoices.map((({email:t})=>[t,t]))),s&&l?(0,j.BX)("div",{children:[(0,j.tZ)(O.Z,{title:f}),h&&(0,j.tZ)(D.Z,{children:h}),m&&m.defaultFieldName&&"weeklyReports"!==m.defaultFieldName&&(0,j.tZ)(y.Z,{saveOnBlur:!0,apiMethod:"PUT",apiEndpoint:"/users/me/notifications/",initialData:s,children:(0,j.tZ)(Z.Z,{title:"Default ".concat(f),fields:[r.fields[m.defaultFieldName]]})}),(0,j.tZ)(a.s_,{children:(0,j.BX)(a.N,{children:[(0,j.BX)(a.V9,{hasButtons:u,children:[(0,j.tZ)(I,{children:u?(0,c.t)("Projects"):(0,c.t)("Organizations")}),(0,j.tZ)("div",{children:u&&this.renderSearchInput({placeholder:(0,c.t)("Search Projects"),url:w,stateKey:v})})]}),(0,j.BX)(y.Z,{saveOnBlur:!0,apiMethod:"PUT",apiEndpoint:"/users/me/notifications/".concat(i,"/"),initialData:l,children:[u&&x&&(0,j.tZ)(C,{projects:n,field:m}),u&&!x&&(0,j.tZ)(P.Z,{children:(0,c.t)("No projects found")}),!u&&(0,j.tZ)(E,{field:m})]})]})}),n&&(0,j.tZ)(o.Z,{pageLinks:p,...this.props})]}):null}}const I=(0,s.Z)("div",{target:"euheq540"})({name:"82a6rk",styles:"flex:1"}),M=(0,l.Z)(A)},"./app/views/settings/components/defaultSearchBar.tsx":(t,e,i)=>{i.d(e,{_:()=>o});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=i("./app/styles/space.tsx");const o=(0,s.Z)("div",{target:"e1pq3sjx0"})("display:flex;grid-template-columns:1fr max-content;grid-gap:",(0,n.Z)(1.5),";margin-top:",(0,n.Z)(4),";margin-bottom:",(0,n.Z)(1.5),";position:relative;")}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_account_accountNotificationFineTuning_tsx.5ba6eee15b681e6e4e2c52ac4a19d200.js.map